var PAGE_WIDTH=12;var DEFAULT_COLUMN_WIDTH=4;var COLORS={1:{name:"gold",color:"#BD8B5C",color_light:"#D9B99C"},2:{name:"silver",color:"#BBBBBB",color_light:"#D6D6D6"},3:{name:"transparent",color:"rgba(0,0,0,0)",color_light:"rgba(0,0,0,0)"},4:{name:"yellow",color:"#FFAB00",color_light:"#FFCE68"},5:{name:"orange",color:"#FF7811",color_light:"#FFAE76"},6:{name:"red",color:"#DD3947",color_light:"#ED8791"},7:{name:"violet",color:"#B341AB",color_light:"#D28CCD"},8:{name:"blue-dark",color:"#3465AB",color_light:"#85A2CF"},9:{name:"blue-light",color:"#66A3A9",color_light:"#A2C8CC"},10:{name:"green-light",color:"#4EBD5F",color_light:"#94D99D"},11:{name:"green-grass",color:"#8FBE2D",color_light:"#BAD981"},12:{name:"green-yellow",color:"#D8BD00",color_light:"#E9D96D"}};function mod_renderer(w,h,G,M,m,d){var J=d;var a=w;var j=h;var g=G;var y=m;var k=mod_helper(J);var x=M;var v=mod_card_structure();var B=mod_design_element_structure();function l(Q){var P=Q.split(":");var R=a;for(var O=0;O<P.length;O++){if(typeof(R)==="string"){break}R=k.get_property(R,P[O]);if(R===null){break}}if(typeof(R)==="string"){return R}else{y.log("template "+Q+" not defined");return"[template "+Q+" not defined]"}}function N(X,P,O,U){if(typeof(P)!=="object"||P===null||Array.isArray(P)){y.log("invalid definition of choices",LOG_LEVEL.error);return[]}if(O===undefined){O="MultilanguageText"}if(typeof(U)!=="string"){U=""}var Y=Object.keys(P);var Q=Y.sort(function(aa,i){var ab=P[aa].list_priority;var Z=P[i].list_priority;if(typeof(ab)!=="number"&&typeof(Z)==="number"){return 1}if(typeof(Z)!=="number"&&typeof(ab)==="number"){return -1}if(typeof(ab)!=="number"&&typeof(Z)!=="number"){if(aa>i){return 1}if(aa<i){return -1}return 0}if(ab<Z){return 1}if(ab>Z){return -1}return 0});var S=[];for(var T=0;T<Q.length;T++){choice=P[Q[T]];if(typeof(choice)==="object"&&choice!==null&&"element_type" in choice){O=choice.element_type}var R=false;var W=null;if(U!==""&&U in choice){W=choice[U]}else{W=Q[T]}if(String(W)===String(X)){R=true}if(R===false&&O==="MultilanguageText"&&choice.hidden===true){continue}var V=null;if(O==="MultilanguageText"){V=x.get_multilanguage_string(choice.label_multilanguage_key,choice.label_multilanguage_key)}else{if(O==="Text"){V=choice.value}else{V=choice}}S.push({label:V,name:choice.name,value:W,selected:R})}return S}if(typeof(J)==="object"&&J!==null){N=J.profile(N)}function D(T,Q){var S={};var P=Object.keys(Q);for(var O=0;O<P.length;O++){var R=T[P[O]];if(!(Array.isArray(R))||R.length===0){continue}S[R[0]]=Q[P[O]]}return S}if(typeof(J)==="object"&&J!==null){D=J.profile(D)}function e(U,P,R,ab){var ae=[];if(P===undefined){P=[]}if(R===undefined){R={}}if(typeof(ab)!=="boolean"){ab=false}if(!(Array.isArray(P))){y.log("invalid element type exclusion",LOG_LEVEL.error);return ae}if(k.is_empty(U)){y.log("invalid card specified for field label extraction",LOG_LEVEL.error);return ae}if(k.is_empty(U.design_elements)){return ae}var O=x.get_element_index(U);var ad=k.get_property(O.card_design_elements,"value");if(!(Array.isArray(ad))){return ae}for(var aa=0;aa<ad.length;aa++){var Z=ad[aa];var W=x.resolve_key(Z);if(k.is_empty(W)){continue}if(W.deleted===true){continue}var Q=x.get_element_index(W);var S=k.get_property(Q.parent_entity_proto_setting,"value");if(typeof(S)==="string"&&S!==""){R[S]=Z}if(ab===true){continue}var ac=k.get_property(W,"element_type");if(ac===null||P.indexOf(ac)!==-1){continue}var i=k.get_property(Q.display_priority,"value");if(typeof(i)!=="number"){i=10}if(i===0){continue}var X=k.get_property(W,"value_type");var V=k.get_property(Q.label,"value");var T=Z;if(typeof(V)==="string"&&V!==""){var Y=x.get_multilanguage_string(V,"");if(Y===""){y.log("cannot retrieve multilanguage string with key "+V+" - multilanguage card is empty or not found in database")}else{T=Y}}ae.push({identifier:Z,label:T,display_priority:i,is_sortable:X!=="key"})}return ae}if(typeof(J)==="object"&&J!==null){e=J.profile(e)}function H(Y,U){if(U===undefined){U=[]}if(!(Array.isArray(U))){y.log("invalid element type exclusion",LOG_LEVEL.error);
return W}if(k.is_empty(Y)){y.log("invalid input specified for field label extraction",LOG_LEVEL.error);return W}var O=null;if(Array.isArray(Y)){O=Y}else{O=[Y]}var W=[];var X=[];for(var Q=0;Q<O.length;Q++){card=O[Q];if(k.is_empty(card.design_elements)){return W}if(!(Array.isArray(card.design_elements))){y.log("invalid design element definition in card",LOG_LEVEL.error);return W}for(var R=0;R<card.design_elements.length;R++){var T=x.get_design_element_identifier(card.design_elements[R]);if(T===null){continue}var S=x.get_design_element_properties(card.design_elements[R]);if(S.deleted===true){continue}var P=k.get_property(S,"element_type");var Z=k.get_property(S,"value_type");if(P===null||U.indexOf(P)!==-1){continue}var V=k.get_property(S,"display_priority");if(typeof(V)!=="number"){V=10}if(V===0){continue}if(X.indexOf(T)===-1){X.push(T);W.push({identifier:T,label:x.get_design_element_label(card.design_elements[R]),display_priority:V,is_sortable:Z!=="key"})}}}return W}if(typeof(J)==="object"&&J!==null){H=J.profile(H)}function u(Q,T){var P={filename_label:x.get_multilanguage_string(ML_KEYS.filename,"filename"),size_label:x.get_multilanguage_string(ML_KEYS.size,"size"),rows:[]};var R=x.get_attachment_names(Q);for(var S=0;S<R.length;S++){var U=current_card._attachments[R[S]];var O={is_last:S===R.length-1,key:R[S],filename:R[S],file_url:T+"/"+R[S],size:(U.length/1000).toFixed(1)+" kB"};P.rows.push(O)}return P}function f(U,Y,Q,W,an,V,Z){if(typeof(Y)!=="string"){Y=""}if(V===undefined){V={}}if(Z===undefined){Z={}}if(!(Array.isArray(Q))){y.log("invalid definition of table view content",LOG_LEVEL.error);return{}}var aa=null;var ac=[];var ab=null;if(typeof(U)==="string"&&U.length>0){var af=U.indexOf("Definition");if(af===-1){aa=x.resolve_key(U);if(k.is_empty(aa)){y.log("Relation proto key is neither an existing proto nor a static definition: "+U,LOG_LEVEL.warning);aa=null}}else{if(Object.keys(v).indexOf(U)===-1){y.log("Relation proto key is neither an existing proto nor a static definition: "+U,LOG_LEVEL.warning)}else{ab=U.substring(0,af);ac=x.get_family_of_user_creatables(ab)}}}if(typeof(aa)!=="object"){y.log("invalid definition of proto card for table view",LOG_LEVEL.error);return{}}var ao={header_cells:[],rows:[]};var au=null;var T=["TableView","Button"];if(!(k.is_empty(aa))){au=e(aa,T,Z)}else{if(Q.length>0){au=H(Q,T)}else{if(ac.length>0){au=H(ac[0],T)}else{au=[]}}}var aq=5;if(V.show_keys_setting!==true){aq=0}ao.header_cells.push({text:"Card Key",identifier:"#",display_priority:aq,use_icon:false,icon_name:"pushpin"});if(V.show_short_name_setting===true){ao.header_cells.push({text:"Short Name",identifier:"&&shortname",display_priority:10,use_icon:false,icon_name:"tag"})}if(V.show_card_type===true){ao.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.card_type,"card type"),identifier:"&&type",display_priority:10,is_sortable:false})}for(var al=0;al<au.length;al++){ao.header_cells.push({text:au[al].label,identifier:au[al].identifier,display_priority:au[al].display_priority,is_sortable:au[al].is_sortable})}if(V.show_modified_setting===true){ao.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.modified,"modified"),identifier:"&&modified",display_priority:5,is_sortable:true})}if(V.show_modifier_setting===true){ao.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.modifier,"modifier"),identifier:"&&modifier",display_priority:5,is_sortable:false})}if(V.show_created_setting===true){ao.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.created,"created"),identifier:"&&created",display_priority:2,is_sortable:true})}if(V.show_creator_setting===true){ao.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.creator,"creator"),identifier:"&&creator",display_priority:2,is_sortable:false})}if(x.is_current_user_admin()&&V.element_type==="TableView"){an.push({modal_id:"tableviewImportActionModal_"+W,title:x.get_multilanguage_string(ML_KEYS.import_modal_title,"Importing Data"),choice_id:"import_attachment_choice",content:A({name:"new_card_proto_choice",value_type:"unicode",element_type:"Text",value:x.get_multilanguage_string(ML_KEYS.import_modal_description)},[],undefined,undefined,undefined,true,true)+A(Object.create(B.StaticFileChoiceField,{value:{value:card._attachments},name:{value:"import_attachment"}}),[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_import_modal",action_style:"primary"})
}if(W==="&&usersTableViewDefinition"&&!(g.is_billable)&&g.number_of_active_users>=2){an.push({modal_id:"tableviewAddActionModal_"+W,title:x.get_multilanguage_string(ML_KEYS.billing_agreement_required,"Billing Agreement Required"),content:A({name:"billing_agreement_explanation",value_type:"unicode",element_type:"Text",value:x.get_multilanguage_string(ML_KEYS.billing_agreement_explanation,"This environment already has two free users defined. In order to add more, please open 'Environment Settings' from the Environment Overview page and accept the billing agreement.")},[],undefined,undefined,undefined,true,true),primary_action_disabled:true,cancel_label:"OK"})}if(V.element_type==="TableView"){return ao}for(var ai=0;ai<Q.length;ai++){if(k.is_empty(Q[ai])){y.log("Invalid related card with index "+String(ai),LOG_LEVEL.error);continue}var at=Q[ai]._id;if(typeof(at)!=="string"||at===""){y.log("Card with invalid key specified for tableview",LOG_LEVEL.error);continue}if(Q[ai].deleted===true){continue}var S=x.get_element_index(Q[ai]);var ah={key:at,cells:[]};ah.cells.push({identifier:"#",content:at});var X=x.get_short_representation(Q[ai]);if(V.show_short_name_setting===true){ah.cells.push({identifier:"&&shortname",content:X})}ah.short_representation=X;if(V.show_card_type===true){ah.cells.push({identifier:"&&type",content:x.get_displayable_card_type(Q[ai])})}ah.is_last=ai===Q.length-1;for(var ae=0;ae<au.length;ae++){var R=au[ae].identifier;var ad=S[R];var ag="";if(!(k.is_empty(ad))){ag=A(ad,Q[ai].design_elements,null,false,null,true,true)}ah.cells.push({identifier:R,content:ag})}var P=null;if(V.show_modified_setting===true){ah.cells.push({identifier:"&&modified",content:A({value:x.get_value_from_last_modification_log_entry(Q[ai],"time"),definition_key:"&&baseDateTimeDefinition"},Q[ai].design_elements,null,false,null,true,true)})}if(V.show_modifier_setting===true){P=x.get_value_from_last_modification_log_entry(Q[ai],"user");ah.cells.push({identifier:"&&modifier",content:A({value:P,value_type:"key",name:"&&modifier",element_type:"Relation"},Q[ai].design_elements,null,false,null,true,true)})}if(V.show_created_setting===true){ah.cells.push({identifier:"&&created",content:A({value:x.get_value_from_first_modification_log_entry(Q[ai],"time"),definition_key:"&&baseDateTimeDefinition"},Q[ai].design_elements,null,false,null,true,true)})}if(V.show_creator_setting===true){P=x.get_value_from_first_modification_log_entry(Q[ai],"user");ah.cells.push({identifier:"&&creator",content:A({value:P,value_type:"key",name:"&&creator",element_type:"Relation"},Q[ai].design_elements,null,false,null,true,true)})}ao.rows.push(ah)}var am={};if(V.allow_new_cards===true){for(var al=0;al<ac.length;al++){var ap=ac[al].title_multilanguage_key;ab=ac[al].definition_type;am[ab]=Object.create(B.StaticMultilanguageTextField,{label_multilanguage_key:{value:ap},name:{value:ab},list_priority:{value:ac[al].list_priority}})}}var O=null;var ak="";var ar="";var aj="";if((k.is_empty(am)&&k.is_empty(aa))||V.allow_new_cards!==true){O={name:"card_proto_choice",value_type:"key",element_type:"Relation",value:"",parent_entity_proto_setting:U,parent_application_setting:Y};ak=x.get_multilanguage_string(ML_KEYS.add_card_modal_description,"Please choose the card you would like to add here.");ar=x.get_multilanguage_string(ML_KEYS.add_card_title,"Adding a Card");aj="existing_card"}else{if(Object.keys(am).length>1){O={name:"card_proto_choice",value_type:"key",element_type:"Choice",value:"",choices:am};ak=x.get_multilanguage_string(ML_KEYS.create_card_modal_description,"Please choose the type of definition you would like to create.");ar=x.get_multilanguage_string(ML_KEYS.create_new_definition_title,"Creating New Definition");aj="static_card"}else{ao.creation_proto_key=Object.keys(am)[0]}}if(O!==null){an.push({modal_id:"tableviewAddActionModal_"+W,title:ar,choice_id:"definition_type_choice",choice_type:aj,content:A({name:"new_card_proto_choice",value_type:"unicode",element_type:"Text",value:ak},[],undefined,undefined,undefined,true,true)+A(O,[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_link_modal_add_card",action_style:"primary"})
}return ao}if(typeof(J)==="object"&&J!==null){f=J.profile(f)}function L(){var O=[];var P=x.resolve_key("&&applicationProperties",false);if(k.is_empty(P)){return O}var Q=x.get_element_index(P);var S=Q.menu_definitions;if(k.is_empty(S)){y.log("application properties without menu entries element");return O}var T=S.value;if(!(Array.isArray(T))){y.log("invalid menu specification in application properties");return O}for(var R=0;R<T.length;R++){if(T[R]==="&&designMenuDefinition"&&g.show_design_menu===false){continue}if(T[R]==="&&adminMenuDefinition"&&g.show_admin_menu===false){continue}O.push(T[R])}return O}if(typeof(J)==="object"&&J!==null){L=J.profile(L)}function o(ab){var V=[];for(var X=0;X<ab.length;X++){var aa=ab[X];var S=x.resolve_key(aa,false);if(typeof(S)!=="object"||S===null){continue}if(S.deleted===true){continue}if(k.is_empty(S)){y.log("could not render menu "+aa+" - empty or not found");continue}var P=x.get_element_index(S);var Q=P.title;var ad="Menu";if(!(k.is_empty(Q))){ad=x.get_multilanguage_string(Q.value,ad)}var ae=P.menu_entries;if(k.is_empty(ae)){y.log("no menu entries specification in menu "+aa);continue}var O=ae.value;if(!(Array.isArray(O))){y.log("invalid menu entries specification in menu "+aa);continue}var R=[];for(var U=0;U<O.length;U++){if(typeof(O[U])!=="string"||O[U]===""){continue}var T=x.resolve_key(O[U]);if(T===null){y.log("cannot resolve menu entry "+O[U]);continue}if(T.deleted===true){continue}if(k.is_empty(T)){y.log("could not get card for menu entry "+O[U]);continue}var W=x.resolve_key(T.proto_key,false);if(x.is_card_hidden(T,W,false)){continue}var Z=null;if(typeof(W)==="object"&&W!==null){Z=W.get_value("theme_color")}if(typeof(Z)!=="string"||Z===""||Z==="transparent"){var Y=k.get_property(g,"theme_color");if(typeof(Y)==="string"&&Y!==""&&Y!=="transparent"){Z=Y}}if(typeof(Z)!=="string"||Z===""){Z="transparent"}var ac=x.get_short_representation(T);R.push({entry_key:O[U],label:ac,theme_color:Z})}if(R.length===0){continue}V.push({title_available:true,menu_title:ad,menu_entries:R,menu_card_id:aa})}return V}if(typeof(J)==="object"&&J!==null){o=J.profile(o)}function z(S,Q,V,P,Y,U,T,W){if(U===undefined){U=""}if(P===undefined){P=false}if(Y===undefined){Y=""}if(typeof(T)!=="boolean"){T=true}if(typeof(W)!=="boolean"){W=false}var O={edit_options:S,edit_group_label:Q,show_label:V,bootstrap_btn_class:U,edit_options_available:Array.isArray(S)&&S.length>0,edit_option_count_one:S.length===1&&!P,dropup:W};var X=false;for(var R=0;R<O.edit_options.length;R++){if(k.is_empty(O.edit_options[R].no_update_action)){O.edit_options[R].no_update_action=O.edit_options[R].action}if(!(O.edit_options[R].is_disabled)){X=true}if(T===false&&(typeof(Y)!=="string"||Y==="")){Y=O.edit_options[R].icon}else{Y="flash"}if(typeof(O.edit_options[R].character_icon)==="string"&&O.edit_options[R].character_icon!==""){O.edit_options[R].use_character_icon=true}if(typeof(O.edit_options[R].modal_id)==="string"&&O.edit_options[R].modal_id!==""){O.edit_options[R].show_modal=true;O.edit_options[R].client_side=true}}if(X!==true){O.is_disabled=true}O.group_icon_available=typeof(Y)==="string"&&Y!=="";O.group_icon=Y;return Mustache.to_html(l("others:edit_options"),O)}if(typeof(J)==="object"&&J!==null){z=J.profile(z)}function n(W,R,P,X,Y,V){if(typeof(R)!=="string"){R=""}if(typeof(X)!=="boolean"){X=false}if(!(Array.isArray(Y))){Y=[]}var S=[];for(var T=0;T<Y.length;T++){var Z=x.get_design_element_label(Y[T]);S.push({label:x.get_multilanguage_string(ML_KEYS.put_to_element_prefix,"put to '")+Z+x.get_multilanguage_string(ML_KEYS.put_to_element_postfix,"'"),action:"put_to_element",no_update_action:"put_to_element",name:W,icon:"pencil",related_key:x.get_design_element_identifier(Y[T])})}if(X===true&&g.selection_mode!="none"){S.push({label:x.get_multilanguage_string(ML_KEYS.remove_from_tableview,"remove from this here"),action:"remove_from_tableview",no_update_action:"remove_from_tableview",name:W,icon:"pencil"})}var U=null;var Q=null;var O=null;if(R!=="deleted"){U="put_to_trash_selected";
Q="no_update_and_put_to_trash_selected";O=x.get_multilanguage_string(ML_KEYS.put_to_trash_label,"put to trash")}else{U="restore_selected";Q="no_update_and_restore_selected";O=x.get_multilanguage_string(ML_KEYS.restore_label,"restore")}if(P&&g.selection_mode!="none"){S.push({label:O,action:U,no_update_action:Q,name:W,icon:"trash"})}if(P&&x.is_current_user_admin()&&g.selection_mode!="none"){S.push({label:x.get_multilanguage_string(ML_KEYS.update_action,"update"),action:"update_selected_action",no_update_action:"no_update_and_update_selected_action",name:W,icon:"pencil"})}if(!(g.application_key==="_users"&&V==="UserDefinition")){if(g.can_import!==false&&P&&x.is_current_user_admin()&&!X){S.push({label:x.get_multilanguage_string(ML_KEYS.import_action,"import"),action:"import_action",no_update_action:"import_action",name:W,icon:"pencil",modal_id:"tableviewImportActionModal_"+W})}}return z(S,x.get_multilanguage_string(ML_KEYS.with_selected_label,"With Selected"),true,true,undefined,"btn-sm")}if(typeof(J)==="object"&&J!==null){n=J.profile(n)}function t(O){var U="";if(g.is_multi_user_client===false){return""}if(k.is_empty(j.user_card)){return""}var S=x.get_element_index(j.user_card);var R=k.get_property(S.first_name,"value");var P=k.get_property(S.last_name,"value");var Q=k.get_property(S.email,"value");var T=k.get_property(S.assigned_roles,"value");var i=k.get_property(j.user_card,"name");if(typeof(R)==="string"){U=(U+R).trim()}if(typeof(P)==="string"){U=(U+" "+P).trim()}if(U===""&&typeof(Q)==="string"){U=Q.trim()}if(U===""&&typeof(i)==="string"){U=i.trim()}if(U===""){y.log("Invalid user profile: needs at least a name attribute in context");U="User Profile"}role="";if(T.indexOf("&&systemRole")!==-1){role=x.get_multilanguage_string(ML_KEYS.environment_administrator,"Environment Administrator")}else{if(Array.isArray(T)&&T.length>0){role_card=x.resolve_key(T[0],false);if(!(k.is_empty(role_card))){role=x.get_short_representation(role_card)}}}if(role===""){role=x.get_multilanguage_string(ML_KEYS.member,"Member")}return Mustache.to_html(l("others:user_menu"),{placement_bottom:O,picture_available:false,username:U,logout_caption:"Logout",logout_url:g.logout_url,user_id:k.get_property(j,"user_id"),edit_user_profile_caption:x.get_multilanguage_string(ML_KEYS.edit_user_profile_caption,"Edit my profile"),role:role})}if(typeof(J)==="object"&&J!==null){t=J.profile(t)}function A(au,T,aE,aO,aS,X,ag,aq,P,aI,aC,aT,an,aL){if(typeof(au)!=="object"||au===null){y.log("invalid design element specified to render",LOG_LEVEL.error);return""}if(!(Array.isArray(T))){T=[]}if(typeof(aE)!=="string"){aE=""}if(typeof(aO)!=="boolean"){aO=false}if(typeof(aS)!=="number"){aS=DEFAULT_COLUMN_WIDTH}if(typeof(X)!=="boolean"){X=false}if(typeof(ag)!=="boolean"){ag=false}if(typeof(aI)!=="boolean"){aI=false}if(typeof(aT)!=="object"){aT={}}if(typeof(aC)!=="string"){aC=""}if(aq===undefined){aq=[]}if(an===undefined){an=[]}if(typeof(P)!=="boolean"){P=true}var af=x.get_design_element_identifier(au);if(af===null){y.log("cannot identify design element",LOG_LEVEL.error);return""}var aB=x.get_design_element_properties(au);if(aB.hidden===true){return""}var aU="";if(P===true&&ag===false){aU=x.get_design_element_label(au)}var Z=null;if(aB.element_type==="LanguageChoice"&&aB.map_to_multilanguage_proto===true){var ar=x.resolve_key("&&multilanguageProto");Z=ar.get_value("card_design_elements",[])}else{if(aB.element_type==="Code"){Z=x.get_responded_value_from_design_element_properties(aB);if(typeof(Z)!=="string"||Z.trim()===""){Z=g.sample_scriptlibrary_source}}else{Z=x.get_responded_value_from_design_element_properties(aB)}}var Q="";if(aB.element_type===undefined&&aB.value_type===undefined){switch(typeof(Z)){case"number":Q="Number";break;case"boolean":Q="YesNo";break;default:Q="Text"}}else{if(aB.element_type===undefined){switch(aB.value_type){case"unicode":Q="Text";break;case"key":Q="Relation";break;case"number":Q="Number";break;case"date":Q="DateTime";break;case"boolean":Q="YesNo";break;default:Q="Text"
}}else{Q=aB.element_type}}var aM=k.get_property(aB,"user_enabled_setting");var ak=true;if(X===true||aM===2||(aO===false&&aM===1)||(Q==="Attachments"&&g.can_edit_attachments===false)||Q==="Button"||Q==="SubmitButton"){ak=false}var R={name:af,value:Z,label:aU,column_width:aS,before_first_save:aO,inline:ag,multi_line:k.get_property(aB,"number_of_lines_setting")===1&&ag!==true,save_first_hint:x.get_multilanguage_string(ML_KEYS.save_first_hint,"save this Card first to edit this element"),disable_label:aB.disable_label===true};var aP=Q;var aG=null;var av=null;var ac=null;var ao=null;var aK=null;if(typeof(aL)==="string"&&aL!==""){aK=aL}else{aK=x.get_active_language()}switch(Q){case"YesNo":R.yes_text=x.get_multilanguage_string(ML_KEYS.yes,"yes");R.no_text=x.get_multilanguage_string(ML_KEYS.no,"no");break;case"Link":aP="Text";break;case"Choice":R.choices=N(Z,aB.choices);break;case"ColorChoice":if(typeof(Z)!=="string"||Z===""){Z="transparent"}R.choices=N(Z,COLORS,"Color","name");break;case"ApplicationChoice":aP="Choice";R.choices=N(Z,g.application_choices,"Text");break;case"DateTimeLanguageChoice":aP="Choice";g.supported_datetime_languages.browser="Browser Language";if(typeof(Z)!=="string"||Z===""){Z="browser"}R.choices=N(Z,g.supported_datetime_languages,"Text");break;case"MultilanguageText":if(Z!==""&&aO===false){if(ag!==true){R.edit_options=z([{label:x.get_multilanguage_string(ML_KEYS.inline_edit_change_meaning,"edit multilanguage card"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",name:af,icon:"pencil"},{label:x.get_multilanguage_string(ML_KEYS.inline_edit_clear,"clear"),action:"clear",character_icon:"×",client_side:true}],x.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit"));R.edit_options_available=true}if(Array.isArray(Z)){y.log("multilanguage text element cannot be defined using multiple values");R.value=""}else{var aJ=x.get_multilanguage_string_and_language(Z);R.value=aJ[0];aK=aJ[1]}}if(typeof(aK)!=="string"||aK===""){aK=x.get_active_language()}R.label+=" ("+aK+")";break;case"Attachments":var ae=g.current_path;if(typeof(ae)!=="string"){ae=""}R.add_attachment_label=x.get_multilanguage_string(ML_KEYS.add_label);R.table_data=u(Z,ae+"/%40%40attachments");R.table_controls_in_header=aI===true;if(aI){an.push({classname:"tableview-only-card"})}R.edit_options=z([{label:x.get_multilanguage_string(ML_KEYS.remove_from_tableview,"remove from this here"),action:"remove_from_tableview",no_update_action:"remove_from_tableview",name:af,icon:"pencil"}],x.get_multilanguage_string(ML_KEYS.with_selected_label,"With Selected"),true,true,undefined,"btn-sm");break;case"Relation":var aa=k.get_property(aB,"parent_entity_proto_setting");if(typeof(aa)==="string"&&aa!==""){R.proto_key=aa}aG=aB.parent_application_setting;if(typeof(aG)==="string"&&aG!==""){R.related_app_id=aG}var ad=k.get_property(aB,"cardinality_setting");var am=null;if(ad===0){ak=false;aP="ParentRelation"}else{if(ad===2){var aV=[];var W=null;if(Array.isArray(Z)){W=Z}else{if(Z===""){W=[]}else{if(typeof(Z)==="string"){W=[Z]}else{y.log("invalid key defined for relation in design element "+af,LOG_LEVEL.error);W=[]}}}if(!aO||aC==="DynamicCard"){for(var aR=0;aR<W.length;aR++){if(typeof(W[aR])!=="string"||W[aR].length===0){continue}am=x.resolve_key(W[aR],false);if(k.is_empty(am)){y.log("cannot display related card "+W[aR]+" in table "+af+": card not found.");continue}if(am.deleted===true){continue}if(k.is_empty(am)){y.log("manually ordered relation contains non existing key or key pointing to invalid card: "+W[aR],LOG_LEVEL.warning);continue}aV.push(am)}}aP="ManuallyOrderedTableView";if(!aO&&ag!==true){var S=k.get_property(aB,"allow_new_cards");if(typeof(S)!=="string"){S=""}av=x.resolve_key(aa,false);R.table_data=f(aa,aG,aV,af,aq,aB);R.table_controls_in_header=aI===true;if(aI){an.push({classname:"tableview-only-card"})}R.edit_options=n(af,undefined,g.readonly!==true&&ak,true);R.allow_new_cards=S;R.use_select_column=g.selection_mode!="none"}else{if(!aO){aP="Text";
var U=[];for(var aR=0;aR<aV.length;aR++){am=aV[aR];U.push(x.get_short_representation(am))}R.value=U.join(",")}}}else{aP="ParentRelation";var Y=[];var at="";am=null;if(typeof(Z)==="string"&&Z!==""){am=x.resolve_key(Z,false)}var aF=x.resolve_key(aa,false);if(ag!==true&&typeof(am)==="object"&&am!==null&&!(x.is_card_hidden(am,aF,false))){Y.push({label:x.get_multilanguage_string(ML_KEYS.inline_edit_related,"edit related card"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",name:af,is_disabled:aO,icon:"pencil",related_app_id:aG});at=x.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit")}if(ag!==true&&ak===true){Y.push({label:x.get_multilanguage_string(ML_KEYS.inline_edit_clear,"clear"),action:"clear",client_side:true,character_icon:"×"});if(!k.is_empty(aF)&&aB.filter_automatically_setting!==false){ac={};e(aF,undefined,ac,true);ao=D(aT,ac);R.filter_column_keys_by_element=JSON.stringify(ao)}}if(ag!==true){R.edit_options=z(Y,at,undefined,undefined,"pencil",undefined,false)}if(ak!==true){if(typeof(am)==="object"&&am!==null){R.relational_info=x.get_short_representation(am)}else{R.relational_info=Z}}var aW=k.get_property(g,"choices_json_url");if(typeof(aW)!=="string"){aW=""}R.choices_json_url=aW;R.relation_resource_available=aW!=="";var az="";if(typeof(aB.couchdb_viewname)==="string"){az=aB.couchdb_viewname}R.couchdb_viewname=az;var ai=aB.parent_application_element;if(typeof(ai)==="string"&&ai!==""){R.app_choice_element=ai}}}break;case"LanguageChoice":var ab=null;if(Array.isArray(Z)){ab=Z}else{if(Z===""){ab=[]}else{if(typeof(Z)==="string"){ab=[Z]}else{y.log("invalid values in language choice design element "+af,LOG_LEVEL.error);ab=[]}}}aP="ManuallyOrderedTableView";if(!aO&&ag!==true){R.allow_new_cards=false;R.disable_click_to_open=true;av=x.resolve_key(aa,false);R.table_data={header_cells:[],rows:[]};R.table_data.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.locale,"Locale"),identifier:"&&locale",display_priority:10,is_sortable:false});R.table_data.header_cells.push({text:x.get_multilanguage_string(ML_KEYS.language,"Language"),identifier:"&&language",display_priority:10,is_sortable:false});for(var aN=0;aN<ab.length;aN++){var ay={key:ab[aN],cells:[]};ay.cells.push({identifier:"&&locale",content:ab[aN]});ay.cells.push({identifier:"&&language",content:LANGUAGE_BY_LOCALE[ab[aN]]});R.table_data.rows.push(ay)}R.table_controls_in_header=aI===true;if(aI){an.push({classname:"tableview-only-card"})}R.edit_options=n(af,undefined,false,true);R.use_select_column=g.selection_mode!="none";var aj={};var ax=x.get_available_locales(aB.limit_variations_to_selected_languages===true,ab);for(var aN=0;aN<ax.length;aN++){var aD=LANGUAGE_BY_LOCALE[ax[aN]];aj[ax[aN]]=Object.create(B.StaticTextField,{value:{value:aD},name:{value:ax[aN]}})}choice_element={name:"card_proto_choice",value_type:"key",element_type:"Choice",value:"",choices:aj};aq.push({modal_id:"tableviewAddActionModal_"+af,title:x.get_multilanguage_string(ML_KEYS.application_language_choice_dialog_title),choice_id:"language_choice",choice_type:"object_key",content:A({name:"language_choice_description",value_type:"unicode",element_type:"Text",value:x.get_multilanguage_string(ML_KEYS.application_language_choice_dialog_description)},[],undefined,undefined,undefined,true,true)+A(choice_element,[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_link_modal_add_card",action_style:"primary"})}else{if(!aO){aP="Text";var U=[];for(var aN=0;aN<ab;aN++){U.push(LANGUAGE_BY_LOCALE[ab[aN]])}R.value=U.join(",")}}break;case"SubmitButton":ak=false;break;case"TableView":ak=false;aG=aB.application_setting;if(typeof(aG)==="string"&&aG!==""){R.related_app_id=aG}var aH=k.get_property(aB,"entity_proto_setting");av=x.resolve_key(aH,false);if(typeof(aH)==="string"){R.proto_key=aH}ac={};if(!aO){R.table_data=f(aH,aG,[],af,aq,aB,ac)}ao=D(aT,ac);var ap=g.multiindex_column_keys_by_proto_key;if(typeof(ap)!=="object"||ap===null){ap={}}var O=ap[aH];if(!(Array.isArray(O))){O=[]
}R.filter_column_keys_by_element=JSON.stringify(ao);R.column_keys_available_for_multiindex=JSON.stringify(O);R.table_controls_in_header=aI===true;if(aI){an.push({classname:"tableview-only-card"})}R.table_height=aI?"400px":"200px";R.show_first_save_hint_instead=aO===true;R.show_create_button=g.readonly!==true&&x.are_new_cards_creatable(av);var aw=null;if(typeof(aB.couchdb_viewname)==="string"&&aB.couchdb_viewname!==""){aw=g.tableview_json_url_with_viewname+"/"+aB.couchdb_viewname}else{aw=g.tableview_json_url}if(typeof(aG)==="string"&&aG!==""&&aG!==g.application_key){matches=aw.match(/(.*\/)(.*?)(\/%40%40tableview_datasource.*?)/);if(matches===null){y.log("The tableview url "+aw+" for element "+af+" does not follow the standard for foreign apps. Foreign app ID: "+aG);aw=""}else{aw=matches[1]+aG+matches[3]}}R.tableview_json_url=aw;var al=[];var aQ=aT[aH];if(Array.isArray(aQ)&&aQ.length>0){var V=x.get_element_index(T);for(var aR=0;aR<aQ.length;aR++){if(aQ[aR]===af||aQ[aR]==="#"){continue}al.push(V[aQ[aR]])}}R.edit_options=n(af,aB.couchdb_viewname,g.readonly!==true&&x.is_card_editable(null,av,false),undefined,al,aH);R.use_select_column=g.selection_mode!="none";break}R.language=aK.replace("_","-");if(aE!==""){R.validation_error=[{text:aE}]}var ah=k.get_property(aB,"help_text");if(ah!==null&&ah!==undefined&&ah!==""){R.help_text=[{text:x.get_multilanguage_string(ah,"")}]}var aA="editable";if(ak===false){aA="readonly"}return Mustache.to_html(l("elements:"+aA+":"+aP),R)}if(typeof(J)==="object"&&J!==null){A=J.profile(A)}function s(i){return Mustache.to_html(l("others:card_row"),{content:i})}function p(S,O,Z,W,aa,ae,ab,U,P,ad){if(W===undefined){W=true}if(P===undefined){P=[]}if(typeof(ad)!=="boolean"){ad=false}if(S.length===0){return""}var V=Math.max(Math.floor(PAGE_WIDTH/S.length),DEFAULT_COLUMN_WIDTH);var T="";var R="";for(var ac=0;ac<S.length;ac++){var X=S[ac];var Q=x.get_design_element_identifier(X);var ag=null;if(ad===true){ag=Q}if(ad===true&&!(Q in LANGUAGE_BY_LOCALE)){ag=null}var Y=Z[Q];var af=x.get_design_element_properties(X);R+=A(X,O.design_elements,Y,aa,V,W,undefined,ae,true,O.design_elements.length===1,ab,U,P,ag)}return R}function F(T,ac,aD,ao){if(aD===undefined){aD=false}if(ac===undefined){ac={}}if(ao===undefined){ao={}}T=x.monkey_patch_card(T);var Y=x.resolve_key(T.proto_key,false);if(x.is_card_hidden(T,Y,true,aD)){y.log("Sorry, you don't have access to this Card.",LOG_LEVEL.message);return""}var ag=x.get_script_library(T);if(k.is_function(ag.on_render)){ag.on_render(T,aD)}var al=k.get_property(T,"design_elements");var aC="";var am=[];var ah=false;var V=false;var au=x.get_card_type(T);var ae=g.readonly!==true&&x.is_card_editable(T,Y,false,aD);var U="";var ak=[];var ad=false;if(T.proto_key==="&&multilanguageProto"){ad=true}if(Array.isArray(al)){var aG=x.get_relation_field_ids_associated_to_proto_by_proto_key(T);var ar=[];var af=0;var at=null;for(var aF=0;aF<al.length;aF++){var an=T.design_elements[aF];at=x.get_design_element_properties(an);if(x.is_design_element_hidden(at)){continue}if(at.deleted===true){continue}var O=k.get_property(at,"element_type");var Z=k.get_property(at,"cardinality_setting");var X=k.get_property(at,"grid_size_setting");var aa=x.get_design_element_identifier(an);var av=ac[aa];if(O==="TableView"||O==="Relation"&&Z===2||X===1||O==="Code"){var ax=p(ar,T,ac,!ae,aD,am,au,aG,ak,ad);if(ax!==""){aC+=s(ax)}af=0;ar=[];aC+=s(p([an],T,ac,!ae,aD,am,au,aG,ak,ad))}else{ar.push(an);af+=DEFAULT_COLUMN_WIDTH;if(af>=PAGE_WIDTH){aC+=s(p(ar,T,ac,!ae,aD,am,au,aG,ak,ad));af=0;ar=[]}}if(ae&&T.persistent!==false&&at.user_enabled_setting!==2&&(aD!==true||at.user_enabled_setting!==1)&&O!=="TableView"&&O!=="Button"){ah=true}}var ai=p(ar,T,ac,!ae,aD,am,au,aG,undefined,ad);if(ai!==""){aC+=s(ai)}if(T.enable_attachments===true||(typeof(Y)==="object"&&Y!==null&&Y.get_value("enable_attachments")===true)){var aE=p([Object.create(B.StaticAttachmentField,{value:{value:T._attachments},name:{value:"attachments"}})],T,ac,!ae,aD,am,au,aG,ak,ad);
aC+=s(aE)}if(al.length===1){at=x.get_design_element_properties(al[0]);if(at.element_type==="TableView"||(at.element_type==="Relation"&&at.cardinality_setting===2)){V=true}}var aA=k.get_property(T,"_id");U=p([{name:"card_id",value_type:"unicode",element_type:"Text",value:aA,label_multilanguage_key:ML_KEYS.card_id}],T,[],true,false,[],undefined,undefined);U+=p([{name:"card_type",value_type:"unicode",element_type:"Text",value:au,label_multilanguage_key:ML_KEYS.card_type}],T,[],true,false,[],undefined,undefined);if(typeof(g.application_key)==="string"&&g.application_key!==""){U+=p([{name:"app_id",value_type:"unicode",element_type:"Text",value:k.get_property(g,"application_key"),label_multilanguage_key:ML_KEYS.app_id}],T,[],true,false,[],undefined,undefined)}}var W=[];var S=x.get_definition(T);if(g.allow_design_mode!==false&&(typeof(T.definition_type)!=="string"||T.definition_type==="")){W.push({label:x.get_multilanguage_string(ML_KEYS.open_proto,"open proto"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",icon:"pencil",related_key:S})}if(T.persistent!==false){W.push({label:x.get_multilanguage_string(ML_KEYS.show_card_properties,"show properties"),action:"show_card_properties",client_side:true,modal_id:"cardPropertiesModal"});am.push({modal_id:"cardPropertiesModal",title:x.get_multilanguage_string(ML_KEYS.card_properties_title,"Card Properties"),content:U,action_link_id:"card_properties_modal",action_style:"primary"})}if(g.allow_trash_actions!==false&&ae&&T.deleted===true&&T.persistent!==false){W.push({label:x.get_multilanguage_string(ML_KEYS.restore_label,"restore"),action:"restore",no_update_action:"no_update_and_restore",icon:"trash"})}else{if(g.allow_trash_actions!==false&&ae&&T.persistent!==false){W.push({label:x.get_multilanguage_string(ML_KEYS.put_to_trash_label,"put to trash"),action:"put_to_trash",no_update_action:"no_update_and_put_to_trash",icon:"trash"})}}if(typeof(Y)==="object"&&Y!==null){ao.color=Y.get_value("theme_color");if(typeof(ao.color)!=="string"||ao.color===""||ao.color==="transparent"){ao.color=k.get_property(g,"theme_color")}}if(g.allow_design_mode!==false&&T.persistent!==false){var ap=L();for(var aF=0;aF<ap.length;aF++){var ay=ap[aF];var Q=x.resolve_key(ay,false);if(typeof(Q)!=="object"||Q===null){continue}var aH=x.get_element_index(Q);if(ay==="&&designMenuDefinition"){var R=aH.menu_entries;if(Array.isArray(R.value)&&R.value.indexOf(T._id)!==-1){ao.color=null}}if(typeof(Q)!=="object"||Q===null||Q.deleted===true||g.readonly===true||!(x.is_card_editable(Q,undefined,false))){continue}var aw=aH.title;var aq="Menu";if(!(k.is_empty(aw))){aq=x.get_multilanguage_string(aw.value,aq)}W.push({label:x.get_multilanguage_string(ML_KEYS.put_into_menu_prefix,"put into menu").trim()+" '"+aq+"'",action:"put_to_menu",icon:"pencil",related_key:ay})}}var P={additional_form_classes:ak,post_save_action:k.get_property(T,"post_save_action"),proto_key:S,card_key:T._id,share_button_available:T.hide_share_button!==true,save_label:x.get_multilanguage_string(ML_KEYS.save_label,"Save"),save_and_close_label:x.get_multilanguage_string(ML_KEYS.save_and_close_label,"Save and Close"),close_without_saving_label:x.get_multilanguage_string(ML_KEYS.close_without_saving_label,"Close without Saving"),rows:aC,cancel_label:x.get_multilanguage_string(ML_KEYS.cancel_label,"Cancel"),action_label:x.get_multilanguage_string(ML_KEYS.ok_label,"OK"),before_first_save:aD,saveable_content_available:ah,card_title:x.get_title(T,aD),card_actions_available:true,disable_padding:V,deleted:T.deleted===true,deleted_label:x.get_multilanguage_string(ML_KEYS.deleted_label,"Deleted"),edit_options:z(W,x.get_multilanguage_string(ML_KEYS.card_menu_label,"This Card"),true,true,undefined,"btn-xs",undefined,true),modal_dialogs:[{modal_id:"saveChangesModal",title:x.get_multilanguage_string(ML_KEYS.save_changes_modal_title,"Save Changes?"),content:x.get_multilanguage_string(ML_KEYS.save_changes_modal_description,"Do you want to save the changes made to this Card?"),action_link_id:"confirm_link_modal",action_style:"primary"},{modal_id:"discardChangesModal",title:x.get_multilanguage_string(ML_KEYS.discard_changes_modal_title,"Discard Changes?"),content:x.get_multilanguage_string(ML_KEYS.discard_changes_modal_description,"Are you sure to discard all changes made to this Card?"),action_link_id:"confirm_link_modal_discard",action_style:"danger"}].concat(am)};
var aB=k.get_property(j,"navigation_stack");var az=ah;if(Array.isArray(aB)){P.breadcrumbs=[];if(aB.length>1){az=true}for(var aF=0;aF<aB.length-1;aF++){var aj={};aj.card_id=aB[aF].id;aj.app_id=aB[aF].app_id;var ab=x.resolve_key(aj.card_id,false);if(ab===null){y.log("could not resolve card id "+aj.card_id+" at position "+aF+" in navigation stack, app "+aj.app_id);continue}aj.representation=x.get_short_representation(ab);P.breadcrumbs.push(aj)}}P.card_closeable=az;return Mustache.to_html(l("others:card"),P)}function b(T){var P={create_application_label:x.get_multilanguage_string(ML_KEYS.create_application_label,"Create Application"),delete_modal_title:x.get_multilanguage_string(ML_KEYS.delete_modal_title,"Deleting an Application"),delete_modal_description:x.get_multilanguage_string(ML_KEYS.delete_modal_description,"Are you sure that you want to delete this application? All design elements and data will be permanently deleted!"),cancel_label:x.get_multilanguage_string(ML_KEYS.cancel_label,"Cancel"),confirm_label:x.get_multilanguage_string(ML_KEYS.confirm_label,"Confirm"),applications:[],user_menu:t(false),show_environment_settings:x.is_current_user_admin(),show_create_application:x.is_current_user_admin()||x.get_user_role_keys().indexOf("&&applicationCreatorRole")!==-1,show_app_delete_button:x.is_current_user_admin(),environment_settings_label:x.get_multilanguage_string(ML_KEYS.environment_settings_label,"Environment Properties"),about_protogrid_label:x.get_multilanguage_string(ML_KEYS.about_protogrid_label,"About Protogrid"),issues_label:x.get_multilanguage_string(ML_KEYS.issues_label,"Report a Problem"),version:g.version,environment_title:g.environment_title};if(Array.isArray(T)){for(var Q=0;Q<T.length;Q++){var W=T[Q];var O=k.get_property(W,"url");if(O===null||O===undefined||O===""){y.log("Invalid application bundle or no url specified",LOG_LEVEL.error);continue}var S=k.get_property(W,"url_name");if(S===null||S===undefined||S===""){y.log("Invalid application bundle or no url name specified",LOG_LEVEL.error);continue}var V=k.get_property(W,"logo_url");if(typeof(V)!=="string"||V===""){V="static/icons/protogrid-152.png"}var R=k.get_property(W,"theme_color");if(typeof(R)!=="string"||R===""){R="transparent"}var U={url:O,name:S,title:k.get_property(W,"title"),description:k.get_property(W,"description"),theme_color:R,logo_url:V,open_label:x.get_multilanguage_string(ML_KEYS.open_label,"Open"),delete_label:x.get_multilanguage_string(ML_KEYS.delete_label,"Delete")};if(["_users","users","_replicator","replicator","roles"].indexOf(S)!==-1){U.show_app_delete_button=false}P.applications.push(U)}}return Mustache.to_html(l("others:environment_portal"),P)}function C(aa,ac,i,Q,V){if(ac===undefined){ac=true}if(i===undefined){i=false}var O=k.get_property(g,"script_root");if(typeof(O)!=="string"){O="";y.log("invalid or no script root set in application context",LOG_LEVEL.error)}var Z=k.get_property(g,"current_path");if(typeof(Z)!=="string"){Z="";y.log("invalid or no path set in application context",LOG_LEVEL.error)}var ae=k.get_property(g,"rows_per_ajax_request");if(typeof(ae)!=="number"){ae=0}var X=k.get_property(g,"root_denominator");if(typeof(X)!=="string"){X=""}var U=[];if(ac===true&&i===false){var R=L();U=o(R)}var ad=g.properties;var ag="";var af=X+"static/images/logo.png";if(!(k.is_empty(ad))){var T=x.get_element_index(ad);var Y=k.get_property(T.title,"value");var W=k.get_property(T.name,"value");var P=k.get_property(T.icon_url,"value");if(typeof(P)==="string"&&P!==""){af=P}ag=x.get_multilanguage_string(Y,W)}var S="";if(typeof(V)==="string"&&V!==""){S="color-"+V}var ab={theme_class:S,content:aa,application_id:k.get_property(g,"application_key"),create_label:x.get_multilanguage_string(ML_KEYS.create_label,"Create"),add_label:x.get_multilanguage_string(ML_KEYS.add_label,"Add"),script_root:O,root_denominator:X,current_path:Z,rows_per_ajax_request:ae,app_title_available:ag!=="",application_title:ag,application_logo_url:af,menus:U,menus_available:ac===true,show_environment_link:g.is_multi_app_client!==false,user_menu:t(Q),preferred_locale:k.get_property(j,"preferred_locale"),app_locale:k.get_property(j,"current_language"),datetime_locale:k.get_property(j,"datetime_locale")};
return Mustache.to_html(l("others:base"),ab)}function I(ah,V){function ak(i){if(!(Array.isArray(i["#"]))||i["#"].length===0){y.log("invalid tableview data entry without key",LOG_LEVEL.error);return null}return i["#"][0]}function al(i){return"<div data-type='key'>"+i+"</div>"}function W(i){return Mustache.to_html(l("elements:readonly:DateTime"),{inline:true,value:i})}function ad(an,ao){var i=x.resolve_key("org.couchdb.user:"+an,false);var ap="";if(typeof(i)==="object"&&i!==null){ap=x.get_short_representation(i)}else{ap=an}return Mustache.to_html(l("elements:readonly:ParentRelation"),{inline:true,relational_info:ap})}function Q(i,an){return Mustache.to_html(l("elements:readonly:Text"),{inline:true,value:i})}function ae(ar,ap,an,ao){var i=ap[an];if(typeof(i)===ao){return i}if(typeof(ar)!=="object"||ar===null){return null}var aq=x.get_element_index(ar);i=k.get_property(aq[an],"value");if(typeof(i)===ao){return i}i=k.get_property(ar,an);if(typeof(i)===ao){return i}return null}function O(an){var i=null;if(an.length>1&&typeof(an[1])==="object"&&an[1]!==null&&!(Array.isArray(an[1]))){i=x.get_multilanguage_string_and_language_from_object_indexed_by_language(an[1],function(ao){return ao})[0]}return i}function ai(an){var ao=x.resolve_key(an,true);var i="";if(ao!==null){i=x.get_short_representation(ao)}return i}function am(ap,av){var ao="";if(!(av in ap)){return ao}var at=ap[av];var an=null;if(Array.isArray(at)&&at.length>0&&Array.isArray(at[0])){for(var ar=0;ar<at.length;ar++){var aq=O(at[ar]);if(typeof(aq)==="string"&&aq!==""){if(ao!==""){ao+=", "}ao+=aq}}}else{if(Array.isArray(at)){ao=O(at);if(typeof(ao)!=="string"||ao===""){ao="";for(var ar=0;ar<at.length;ar++){var au=x.resolve_key(at[ar],false);if(typeof(au)!=="object"||au===null){continue}if(ao!==""){ao+=", "}ao+=ai(at[ar])}}}else{if(typeof(at)==="string"&&at!==""){ao=ai(at)}else{if(typeof(at)!=="string"){y.log("Invalid entry '"+av+"' in tableview data: "+JSON.stringify(ap))}}}}return ao}function Y(an,aq,ao,ar){if(!(aq in an)&&(typeof(ao)!=="object"||ao===null)){var i=x.resolve_key(ak(an),false);if(i===null||i===undefined){return null}var ap="";switch(aq){case"#":y.log("tableview data entry without key",LOG_LEVEL.error);break;case"&&shortname":ap=x.get_short_representation(i);break;case"&&modified":ap=x.get_value_from_last_modification_log_entry(i,"time");break;case"&&created":ap=x.get_value_from_first_modification_log_entry(i,"time");break;case"&&modifier":ap=x.get_value_from_last_modification_log_entry(i,"user");break;case"&&creator":ap=x.get_value_from_first_modification_log_entry(i,"user");break;case"&&type":ap=x.get_displayable_card_type(i);break}ao={definition_key:aq,value:ap}}else{if(typeof(ao)!=="object"||ao===null){ao={definition_key:aq,value:an[aq][0]}}}if(aq==="#"){return al(ao.value)}if(aq==="&&shortname"){if(typeof(ao.value)==="object"&&ao.value!==null){ml_text=x.get_multilanguage_string_and_language_from_object_indexed_by_language(ao.value,function(au){return au})[0];return Q(ml_text,aq)}if(typeof(ao.value)==="string"){return Q(ao.value,aq)}y.log("could not render own shortname - invalid data type in tableview data: "+typeof(ao.value));return null}if(aq==="&&type"){return ao.value}if(aq==="&&modified"||aq==="&&created"){return W(ao.value,aq)}if(aq==="&&modifier"||aq==="&&creator"){return ad(ao.value,aq)}if(ae(ar,ao,"deleted","boolean")===true){return null}if(ae(ar,ao,"display_priority","number")===0){return null}var at=ae(ar,ao,"element_type","string");if(typeof(at)!=="string"||at===""||["TableView","Button","Code"].indexOf(at)!==-1){return null}if(at==="Relation"){ml_text=am(an,aq);return Q(ml_text,aq)}if(["Text","Number"].indexOf(at)!==-1){return ao.value}if(at==="DateTime"){return Mustache.to_html(l("elements:readonly:"+at),{inline:true,value:ao.value})}return A(ao,undefined,undefined,undefined,undefined,true,true,undefined,false)}function T(ap,aq){if(k.is_empty(ap)){y.log("cannot reconstruct card from tableview data entry: empty entry");return{}}if(k.is_empty(aq)){y.log("cannot reconstruct card from tableview data entry: no proto");
return{}}var av=[];var at=x.get_element_index(aq);var au=at.card_design_elements.value;for(var ar=0;ar<au.length;ar++){var aw="";if(au[ar] in ap){aw=ap[au[ar]][0]}av.push({definition_key:au[ar],value:aw})}var ao=[];var ax={};if("&&creator" in ap){ax.user=ap["&&creator"][0]}if("&&created" in ap){ax.time=ap["&&created"][0]}var an={};if("&&modifier" in ap){an.user=ap["&&modifier"][0]}if("&&modified" in ap){an.time=ap["&&modified"][0]}ao.push(ax);ao.push(an);return{_id:ap["#"][0],proto_key:aq._id,design_elements:av,modification_log:ao}}if(typeof(V)!=="string"){V=""}if(!(Array.isArray(ah))){y.log("invalid input to tableview data gathering function",LOG_LEVEL.error);return[]}var aj=[];for(var af=0;af<ah.length;af++){var P=null;var X=null;if("&&proto_key" in ah[af]){X=x.resolve_key(ah[af]["&&proto_key"][0]);P=T(ah[af],X)}else{P=x.resolve_key(ak(ah[af]));var ac=x.get_card_type(P);P=x.get_healed_card(P)}if(x.is_card_hidden(P,X,false)){continue}var aa={};var S=x.get_element_index(P);var U=Object.keys(S);var Z=null;for(var ag=0;ag<U.length;ag++){var ab=x.resolve_key(U[ag],false);Z=Y(ah[af],U[ag],S[U[ag]],ab);if(typeof(Z)!=="string"){continue}aa[U[ag]]=Z}var R=["#","&&shortname","&&modified","&&created","&&modifier","&&creator","&&type"];for(var ag=0;ag<R.length;ag++){Z=Y(ah[af],R[ag]);if(typeof(Z)!=="string"){continue}aa[R[ag]]=Z}if(g.selection_mode!="none"){aa["&&select"]="<input type='checkbox' class='no-click-to-open selected-single' name='selected_"+V+"' value='"+P._id+"'>"}aj.push(aa)}return aj}var E={render_card:F,render_page:C,render_environment_portal:b,get_rendered_tableview_data:I};var r={};var c=Object.keys(E);for(var K=0;K<c.length;K++){var q=E[c[K]];if(typeof(J)==="object"&&J!==null){r[c[K]]=J.profile(q)}else{r[c[K]]=q}}return r};
var PAGE_WIDTH=12;var DEFAULT_COLUMN_WIDTH=4;var COLORS={1:{name:"gold",color:"#BD8B5C",color_light:"#D9B99C"},2:{name:"silver",color:"#BBBBBB",color_light:"#D6D6D6"},3:{name:"transparent",color:"rgba(0,0,0,0)",color_light:"rgba(0,0,0,0)"},4:{name:"yellow",color:"#FFAB00",color_light:"#FFCE68"},5:{name:"orange",color:"#FF7811",color_light:"#FFAE76"},6:{name:"red",color:"#DD3947",color_light:"#ED8791"},7:{name:"violet",color:"#B341AB",color_light:"#D28CCD"},8:{name:"blue-dark",color:"#3465AB",color_light:"#85A2CF"},9:{name:"blue-light",color:"#66A3A9",color_light:"#A2C8CC"},10:{name:"green-light",color:"#4EBD5F",color_light:"#94D99D"},11:{name:"green-grass",color:"#8FBE2D",color_light:"#BAD981"},12:{name:"green-yellow",color:"#D8BD00",color_light:"#E9D96D"}};function mod_renderer(x,j,I,O,n,e){var L=e;var a=x;var k=j;var h=I;var z=n;var l=mod_helper(L);var y=O;var w=mod_card_structure();var D=mod_design_element_structure();function m(S){var R=S.split(":");var T=a;for(var Q=0;Q<R.length;Q++){if(typeof(T)==="string"){break}T=l.get_property(T,R[Q]);if(T===null){break}}if(typeof(T)==="string"){return T}else{z.log("template "+S+" not defined");return"[template "+S+" not defined]"}}function P(Z,R,Q,W){if(typeof(R)!=="object"||R===null||Array.isArray(R)){z.log("invalid definition of choices",LOG_LEVEL.error);return[]}if(Q===undefined){Q="MultilanguageText"}if(typeof(W)!=="string"){W=""}var aa=Object.keys(R);var S=aa.sort(function(ac,i){var ad=R[ac].list_priority;var ab=R[i].list_priority;if(typeof(ad)!=="number"&&typeof(ab)==="number"){return 1}if(typeof(ab)!=="number"&&typeof(ad)==="number"){return -1}if(typeof(ad)!=="number"&&typeof(ab)!=="number"){if(ac>i){return 1}if(ac<i){return -1}return 0}if(ad<ab){return 1}if(ad>ab){return -1}return 0});var U=[];for(var V=0;V<S.length;V++){choice=R[S[V]];if(typeof(choice)==="object"&&choice!==null&&"element_type" in choice){Q=choice.element_type}var T=false;var Y=null;if(W!==""&&W in choice){Y=choice[W]}else{Y=S[V]}if(String(Y)===String(Z)){T=true}if(T===false&&Q==="MultilanguageText"&&choice.hidden===true){continue}var X=null;if(Q==="MultilanguageText"){X=y.get_multilanguage_string(choice.label_multilanguage_key,choice.label_multilanguage_key)}else{if(Q==="Text"){X=choice.value}else{X=choice}}U.push({label:X,name:choice.name,value:Y,selected:T})}return U}if(typeof(L)==="object"&&L!==null){P=L.profile(P)}function F(W,S,T){var V={};var R=Object.keys(S);for(var Q=0;Q<R.length;Q++){var U=W[R[Q]];if(!(Array.isArray(U))||U.length===0){continue}V[U[0]]=S[R[Q]]}return V}if(typeof(L)==="object"&&L!==null){F=L.profile(F)}function f(W,R,T,ae){var ah=[];if(R===undefined){R=[]}if(T===undefined){T={}}if(typeof(ae)!=="boolean"){ae=false}if(!(Array.isArray(R))){z.log("invalid element type exclusion",LOG_LEVEL.error);return ah}if(l.is_empty(W)){z.log("invalid card specified for field label extraction",LOG_LEVEL.error);return ah}if(l.is_empty(W.design_elements)){return ah}var Q=y.get_element_index(W);var ag=l.get_property(Q.card_design_elements,"value");if(!(Array.isArray(ag))){return ah}for(var ad=0;ad<ag.length;ad++){var ab=ag[ad];var Y=y.resolve_key(ab);if(l.is_empty(Y)){continue}if(Y.deleted===true){continue}var S=y.get_element_index(Y);var U=l.get_property(S.parent_entity_proto_setting,"value");if(typeof(U)==="string"&&U!==""){T[U]=ab}var ac=l.get_property(Y,"definition_type");if(ac!==null&&ac==="DateTimeField"){T[ab]=ab}if(ae===true){continue}var af=l.get_property(Y,"element_type");if(af===null||R.indexOf(af)!==-1){continue}var i=l.get_property(S.display_priority,"value");if(typeof(i)!=="number"){i=Y.display_priority}if(typeof(i)!=="number"){i=10}if(i===0){continue}var Z=l.get_property(Y,"value_type");var X=l.get_property(S.label,"value");var V=ab;if(typeof(X)==="string"&&X!==""){var aa=y.get_multilanguage_string(X,"");if(aa===""){z.log("cannot retrieve multilanguage string with key "+X+" - multilanguage card is empty or not found in database",LOG_LEVEL.warning)}else{V=aa}}ah.push({identifier:ab,label:V,display_priority:i,value_type:Z,is_sortable:Z!=="key"})
}return ah}if(typeof(L)==="object"&&L!==null){f=L.profile(f)}function J(aa,W){if(W===undefined){W=[]}if(!(Array.isArray(W))){z.log("invalid element type exclusion",LOG_LEVEL.error);return Y}if(l.is_empty(aa)){z.log("invalid input specified for field label extraction",LOG_LEVEL.error);return Y}var Q=null;if(Array.isArray(aa)){Q=aa}else{Q=[aa]}var Y=[];var Z=[];for(var S=0;S<Q.length;S++){card=Q[S];if(l.is_empty(card.design_elements)){return Y}if(!(Array.isArray(card.design_elements))){z.log("invalid design element definition in card",LOG_LEVEL.error);return Y}for(var T=0;T<card.design_elements.length;T++){var V=y.get_design_element_identifier(card.design_elements[T]);if(V===null){continue}var U=y.get_design_element_properties(card.design_elements[T]);if(U.deleted===true){continue}var R=l.get_property(U,"element_type");var ab=l.get_property(U,"value_type");if(R===null||W.indexOf(R)!==-1){continue}var X=l.get_property(U,"display_priority");if(typeof(X)!=="number"){X=10}if(X===0){continue}if(Z.indexOf(V)===-1){Z.push(V);Y.push({identifier:V,label:y.get_design_element_label(card.design_elements[T]),display_priority:X,value_type:ab,is_sortable:ab!=="key"})}}}return Y}if(typeof(L)==="object"&&L!==null){J=L.profile(J)}function v(S,V){var R={filename_label:y.get_multilanguage_string(ML_KEYS.filename,"filename"),size_label:y.get_multilanguage_string(ML_KEYS.size,"size"),rows:[]};var T=y.get_attachment_names(S);for(var U=0;U<T.length;U++){var W=current_card._attachments[T[U]];var Q={is_last:U===T.length-1,key:T[U],filename:T[U],file_url:V+"/"+T[U],size:(W.length/1000).toFixed(1)+" kB"};R.rows.push(Q)}return R}function g(W,aa,S,Y,ar,X,ab){if(typeof(aa)!=="string"){aa=""}if(X===undefined){X={}}if(ab===undefined){ab={}}if(!(Array.isArray(S))){z.log("invalid definition of table view content",LOG_LEVEL.error);return{}}var ac=null;var ae=[];var ad=null;if(typeof(W)==="string"&&W.length>0){var ai=W.indexOf("Definition");if(ai===-1){ac=y.resolve_key(W);if(l.is_empty(ac)){z.log("Relation proto key is neither an existing proto nor a static definition: "+W,LOG_LEVEL.warning);ac=null}}else{if(Object.keys(w).indexOf(W)===-1){z.log("Relation proto key is neither an existing proto nor a static definition: "+W,LOG_LEVEL.warning)}else{ad=W.substring(0,ai);ae=y.get_family_of_user_creatables(ad)}}}if(typeof(ac)!=="object"){z.log("invalid definition of proto card for table view",LOG_LEVEL.error);return{}}var at={header_cells:[],rows:[]};var ay=null;var V=["TableView","Button"];if(!(l.is_empty(ac))){ay=f(ac,V,ab)}else{if(S.length>0){ay=J(S,V)}else{if(ae.length>0){ay=J(ae[0],V)}else{ay=[]}}}var av=5;if(X.show_keys_setting!==true){av=0}at.header_cells.push({text:"Card Key",identifier:"#",display_priority:av,use_icon:false,icon_name:"pushpin"});if(X.show_short_name_setting===true){at.header_cells.push({text:"Short Name",identifier:"&&shortname",display_priority:10,use_icon:false,icon_name:"tag"})}if(X.show_card_type===true){at.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.card_type,"card type"),identifier:"&&type",display_priority:10,is_sortable:false})}for(var ao=0;ao<ay.length;ao++){at.header_cells.push({text:ay[ao].label,identifier:ay[ao].identifier,display_priority:ay[ao].display_priority,value_type:ay[ao].value_type,is_sortable:ay[ao].is_sortable})}if(X.show_modified_setting===true){at.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.modified,"modified"),identifier:"&&modified",display_priority:5,is_sortable:true})}if(X.show_modifier_setting===true){at.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.modifier,"modifier"),identifier:"&&modifier",display_priority:5,is_sortable:false})}if(X.show_created_setting===true){at.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.created,"created"),identifier:"&&created",display_priority:2,is_sortable:true})}if(X.show_creator_setting===true){at.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.creator,"creator"),identifier:"&&creator",display_priority:2,is_sortable:false})
}var ag=l.get_property(h,"root_denominator");if(typeof(ag)!=="string"){ag=""}if(y.is_current_user_admin()&&X.element_type==="TableView"){ar.push({modal_id:"tableviewImportActionModal_"+Y,title:y.get_multilanguage_string(ML_KEYS.import_modal_title,"Importing Data"),choice_id:"import_attachment_choice",content:C({name:"new_card_proto_choice",value_type:"unicode",element_type:"Text",value:y.get_multilanguage_string(ML_KEYS.import_modal_description)},[],undefined,undefined,undefined,true,true)+"<div><a target='_blank' href='http://web.protogrid.com/choco/docs/Protogrid-CSV-Import.pdf'><img border='0' alt='Instructions' style='padding:5px 0 20px 0' src='"+ag+"static/images/pdficon_large.png'></a></div>"+C(Object.create(D.StaticFileChoiceField,{value:{value:card._attachments},name:{value:"import_attachment"}}),[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_import_modal",action_style:"primary"})}if(Y==="&&usersTableViewDefinition"&&!(h.is_billable)&&h.number_of_active_users>=2){ar.push({modal_id:"tableviewAddActionModal_"+Y,title:y.get_multilanguage_string(ML_KEYS.billing_agreement_required,"Billing Agreement Required"),content:C({name:"billing_agreement_explanation",value_type:"unicode",element_type:"Text",value:y.get_multilanguage_string(ML_KEYS.billing_agreement_explanation,"This environment already has two free users defined. In order to add more, please open 'Environment Settings' from the Environment Overview page and accept the billing agreement.")},[],undefined,undefined,undefined,true,true),primary_action_disabled:true,cancel_label:"OK"})}if(X.element_type==="TableView"){return at}for(var al=0;al<S.length;al++){if(l.is_empty(S[al])){z.log("Invalid related card with index "+String(al),LOG_LEVEL.error);continue}var ax=S[al]._id;if(typeof(ax)!=="string"||ax===""){z.log("Card with invalid key specified for tableview",LOG_LEVEL.error);continue}if(S[al].deleted===true){continue}var U=y.get_element_index(S[al]);var ak={key:ax,cells:[]};ak.cells.push({identifier:"#",content:ax});var Z=y.get_short_representation(S[al],undefined,undefined,undefined,undefined,undefined,true);if(X.show_short_name_setting===true){ak.cells.push({identifier:"&&shortname",content:Z})}ak.short_representation=Z;if(X.show_card_type===true){ak.cells.push({identifier:"&&type",content:y.get_displayable_card_type(S[al])})}ak.is_last=al===S.length-1;for(var ah=0;ah<ay.length;ah++){var T=ay[ah].identifier;var af=U[T];var aj="";if(!(l.is_empty(af))){aj=C(af,S[al].design_elements,null,false,null,true,true)}ak.cells.push({identifier:T,content:aj})}var R=null;if(X.show_modified_setting===true){ak.cells.push({identifier:"&&modified",content:C({value:y.get_value_from_last_modification_log_entry(S[al],"time"),definition_key:"&&baseDateTimeDefinition"},S[al].design_elements,null,false,null,true,true)})}if(X.show_modifier_setting===true){R=y.get_value_from_last_modification_log_entry(S[al],"user");ak.cells.push({identifier:"&&modifier",content:C({value:R,value_type:"key",name:"&&modifier",element_type:"Relation"},S[al].design_elements,null,false,null,true,true)})}if(X.show_created_setting===true){ak.cells.push({identifier:"&&created",content:C({value:y.get_value_from_first_modification_log_entry(S[al],"time"),definition_key:"&&baseDateTimeDefinition"},S[al].design_elements,null,false,null,true,true)})}if(X.show_creator_setting===true){R=y.get_value_from_first_modification_log_entry(S[al],"user");ak.cells.push({identifier:"&&creator",content:C({value:R,value_type:"key",name:"&&creator",element_type:"Relation"},S[al].design_elements,null,false,null,true,true)})}at.rows.push(ak)}var ap={};if(X.allow_new_cards===true){for(var ao=0;ao<ae.length;ao++){var au=ae[ao].title_multilanguage_key;ad=ae[ao].definition_type;ap[ad]=Object.create(D.StaticMultilanguageTextField,{label_multilanguage_key:{value:au},name:{value:ad},list_priority:{value:ae[ao].list_priority}})}}var Q=null;var an="";var aw="";var am="";if((l.is_empty(ap)&&l.is_empty(ac))||X.allow_new_cards!==true){Q={name:"card_proto_choice",value_type:"key",element_type:"Relation",value:"",parent_entity_proto_setting:W,parent_application_setting:aa};
an=y.get_multilanguage_string(ML_KEYS.add_card_modal_description,"Please choose the card you would like to add here.");aw=y.get_multilanguage_string(ML_KEYS.add_card_title,"Adding a Card");am="existing_card";var aq="";if(typeof(X.couchdb_viewname)==="string"){aq=X.couchdb_viewname}Q.couchdb_viewname=aq}else{if(Object.keys(ap).length>1){Q={name:"card_proto_choice",value_type:"key",element_type:"Choice",value:"",choices:ap};an=y.get_multilanguage_string(ML_KEYS.create_card_modal_description,"Please choose the type of definition you would like to create.");aw=y.get_multilanguage_string(ML_KEYS.create_new_definition_title,"Creating New Definition");am="static_card"}else{at.creation_proto_key=Object.keys(ap)[0]}}if(Q!==null){ar.push({modal_id:"tableviewAddActionModal_"+Y,title:aw,choice_id:"definition_type_choice",choice_type:am,content:C({name:"new_card_proto_choice",value_type:"unicode",element_type:"Text",value:an},[],undefined,undefined,undefined,true,true)+C(Q,[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_link_modal_add_card",action_style:"primary"})}return at}if(typeof(L)==="object"&&L!==null){g=L.profile(g)}function N(){var Q=[];var R=y.resolve_key("&&applicationProperties",false);if(l.is_empty(R)){return Q}var S=y.get_element_index(R);var U=S.menu_definitions;if(l.is_empty(U)){z.log("application properties without menu entries element");return Q}var V=U.value;if(!(Array.isArray(V))){z.log("invalid menu specification in application properties");return Q}for(var T=0;T<V.length;T++){if(V[T]==="&&designMenuDefinition"&&h.show_design_menu===false){continue}if(V[T]==="&&adminMenuDefinition"&&h.show_admin_menu===false){continue}Q.push(V[T])}return Q}if(typeof(L)==="object"&&L!==null){N=L.profile(N)}function p(ad){var X=[];for(var Z=0;Z<ad.length;Z++){var ac=ad[Z];var U=y.resolve_key(ac,false);if(typeof(U)!=="object"||U===null){continue}if(U.deleted===true){continue}if(l.is_empty(U)){z.log("could not render menu "+ac+" - empty or not found");continue}var R=y.get_element_index(U);var S=R.title;var af="Menu";if(!(l.is_empty(S))){af=y.get_multilanguage_string(S.value,af)}var ag=R.menu_entries;if(l.is_empty(ag)){z.log("no menu entries specification in menu "+ac);continue}var Q=ag.value;if(!(Array.isArray(Q))){z.log("invalid menu entries specification in menu "+ac);continue}var T=[];for(var W=0;W<Q.length;W++){if(typeof(Q[W])!=="string"||Q[W]===""){continue}var V=y.resolve_key(Q[W]);if(V===null){z.log("cannot resolve menu entry "+Q[W]);continue}if(V.deleted===true){continue}if(l.is_empty(V)){z.log("could not get card for menu entry "+Q[W]);continue}var Y=y.resolve_key(V.proto_key,false);if(y.is_card_hidden(V,Y,false)){continue}var ab=null;if(typeof(Y)==="object"&&Y!==null){ab=Y.get_value("theme_color")}if(typeof(ab)!=="string"||ab===""||ab==="transparent"){var aa=l.get_property(h,"theme_color");if(typeof(aa)==="string"&&aa!==""&&aa!=="transparent"){ab=aa}}if(typeof(ab)!=="string"||ab===""){ab="transparent"}var ae=y.get_short_representation(V,undefined,undefined,undefined,undefined,undefined,true);T.push({entry_key:Q[W],label:ae,theme_color:ab})}if(T.length===0){continue}X.push({title_available:true,menu_title:af,menu_entries:T,menu_card_id:ac})}return X}if(typeof(L)==="object"&&L!==null){p=L.profile(p)}function B(U,R,Q){var S=false;for(var T=0;T<U.edit_options.length;T++){if(l.is_empty(U.edit_options[T].no_update_action)){U.edit_options[T].no_update_action=U.edit_options[T].action}if(!(U.edit_options[T].is_disabled)){S=true}if(Q===false&&(typeof(R)!=="string"||R==="")){R=U.edit_options[T].icon}else{R="flash"}if(typeof(U.edit_options[T].character_icon)==="string"&&U.edit_options[T].character_icon!==""){U.edit_options[T].use_character_icon=true}if(typeof(U.edit_options[T].modal_id)==="string"&&U.edit_options[T].modal_id!==""){U.edit_options[T].show_modal=true;U.edit_options[T].client_side=true}}if(S!==true){U.is_disabled=true}U.group_icon_available=typeof(R)==="string"&&R!=="";U.group_icon=R}function A(S,R,V,Q,X,U,T,W){if(U===undefined){U=""
}if(Q===undefined){Q=false}if(X===undefined){X=""}if(typeof(T)!=="boolean"){T=true}if(typeof(W)!=="boolean"){W=false}var i={edit_options:S,edit_group_label:R,show_label:V,bootstrap_btn_class:U,edit_options_available:Array.isArray(S)&&S.length>0,edit_option_count_one:S.length===1&&!Q,dropup:W};B(i,X,T);return Mustache.to_html(m("others:edit_options"),i)}if(typeof(L)==="object"&&L!==null){A=L.profile(A)}function o(Z,U,S,aa,ab,Y,Q){if(typeof(U)!=="string"){U=""}if(typeof(aa)!=="boolean"){aa=false}if(!(Array.isArray(ab))){ab=[]}if(Q===undefined){Q=[]}var W=[];for(var V=0;V<ab.length;V++){var ac=y.get_design_element_label(ab[V]);W.push({label:y.get_multilanguage_string(ML_KEYS.put_to_element_prefix,"put to '")+ac+y.get_multilanguage_string(ML_KEYS.put_to_element_postfix,"'"),action:"put_to_element",no_update_action:"put_to_element",name:Z,icon:"pencil",related_key:y.get_design_element_identifier(ab[V])})}if(aa===true&&h.selection_mode!="none"){W.push({label:y.get_multilanguage_string(ML_KEYS.remove_from_tableview,"remove from this here"),action:"remove_from_tableview",no_update_action:"remove_from_tableview",name:Z,icon:"pencil"})}var X=null;var T=null;var R=null;if(U!=="deleted"){X="put_to_trash_selected";T="no_update_and_put_to_trash_selected";R=y.get_multilanguage_string(ML_KEYS.put_to_trash_label,"put to trash")}else{X="restore_selected";T="no_update_and_restore_selected";R=y.get_multilanguage_string(ML_KEYS.restore_label,"restore")}if(S&&h.selection_mode!="none"){W.push({label:R,action:X,no_update_action:T,name:Z,icon:"trash"})}if(S&&y.is_current_user_admin()&&h.selection_mode!="none"){W.push({label:y.get_multilanguage_string(ML_KEYS.update_action,"update"),action:"update_selected_action",no_update_action:"no_update_and_update_selected_action",name:Z,icon:"pencil"})}if(!(h.application_key==="_users"&&Y==="UserDefinition")){if(h.can_import!==false&&S&&y.is_current_user_admin()&&!aa){W.push({label:y.get_multilanguage_string(ML_KEYS.import_action,"import"),action:"import_action",no_update_action:"import_action",name:Z,icon:"pencil",modal_id:"tableviewImportActionModal_"+Z});W.push({label:y.get_multilanguage_string(ML_KEYS.export_action,"export"),action:"export_action",name:Z,icon:"pencil"})}}for(var V=0;V<Q.length;V++){W.push(Q[V])}return A(W,y.get_multilanguage_string(ML_KEYS.with_selected_label,"With Selected"),true,true,undefined,"btn-sm")}if(typeof(L)==="object"&&L!==null){o=L.profile(o)}function u(Q){var W="";if(h.is_multi_user_client===false){return""}if(l.is_empty(k.user_card)){return""}var U=y.get_element_index(k.user_card);var T=l.get_property(U.first_name,"value");var R=l.get_property(U.last_name,"value");var S=l.get_property(U.email,"value");var V=l.get_property(U.assigned_roles,"value");var i=l.get_property(k.user_card,"name");if(typeof(T)==="string"){W=(W+T).trim()}if(typeof(R)==="string"){W=(W+" "+R).trim()}if(W===""&&typeof(S)==="string"){W=S.trim()}if(W===""&&typeof(i)==="string"){W=i.trim()}if(W===""){z.log("Invalid user profile: needs at least a name attribute in context");W="User Profile"}role="";if(V.indexOf("&&systemRole")!==-1){role=y.get_multilanguage_string(ML_KEYS.environment_administrator,"Environment Administrator")}else{if(Array.isArray(V)&&V.length>0){role_card=y.resolve_key(V[0],false);if(!(l.is_empty(role_card))){role=y.get_short_representation(role_card,undefined,undefined,undefined,undefined,undefined,true)}}}if(role===""){role=y.get_multilanguage_string(ML_KEYS.member,"Member")}return Mustache.to_html(m("others:user_menu"),{placement_bottom:Q,picture_available:false,username:W,logout_caption:"Logout",logout_url:h.logout_url,user_id:l.get_property(k,"user_id"),edit_user_profile_caption:y.get_multilanguage_string(ML_KEYS.edit_user_profile_caption,"Edit my profile"),role:role})}if(typeof(L)==="object"&&L!==null){u=L.profile(u)}function c(S,Q){for(var T=0;T<S.length;T++){var U=y.resolve_key(S[T],true);var R=y.get_design_element_properties_by_name(U,"js_call").value;Q.push({label:y.get_multilanguage_string(y.get_design_element_properties_by_name(U,"name").value,R),action:R,client_side:true,user_defined_action:true,icon:"flash"})
}}function C(ay,V,aK,aU,aY,Z,aj,av,R,aO,aI,aZ,ar,aR){if(typeof(ay)!=="object"||ay===null){z.log("invalid design element specified to render",LOG_LEVEL.error);return""}if(!(Array.isArray(V))){V=[]}if(typeof(aK)!=="string"){aK=""}if(typeof(aU)!=="boolean"){aU=false}if(typeof(aY)!=="number"){aY=DEFAULT_COLUMN_WIDTH}if(typeof(Z)!=="boolean"){Z=false}if(typeof(aj)!=="boolean"){aj=false}if(typeof(aO)!=="boolean"){aO=false}if(typeof(aZ)!=="object"){aZ={}}if(typeof(aI)!=="string"){aI=""}if(av===undefined){av=[]}if(ar===undefined){ar=[]}if(typeof(R)!=="boolean"){R=true}var ai=y.get_design_element_identifier(ay);if(ai===null){z.log("cannot identify design element",LOG_LEVEL.error);return""}var aG=y.get_design_element_properties(ay);if(aG.hidden===true){return""}var a1="";if(R===true&&aj===false){a1=y.get_design_element_label(ay)}var aa=null;if(aG.element_type==="LanguageChoice"&&aG.map_to_multilanguage_proto===true){var aw=y.resolve_key("&&multilanguageProto");aa=aw.get_value("card_design_elements",[])}else{if(aG.code_type==="ServerScriptLibrary"){aa=y.get_responded_value_from_design_element_properties(aG);if(typeof(aa)!=="string"||aa.trim()===""){aa=h.sample_scriptlibrary_source}}else{if(aG.code_type==="ClientScriptLibrary"){aa=y.get_responded_value_from_design_element_properties(aG);if(typeof(aa)!=="string"||aa.trim()===""){aa=h.sample_client_scriptlibrary_source}}else{aa=y.get_responded_value_from_design_element_properties(aG)}}}var S="";if(aG.element_type===undefined&&aG.value_type===undefined){switch(typeof(aa)){case"number":S="Number";break;case"boolean":S="YesNo";break;default:S="Text"}}else{if(aG.element_type===undefined){switch(aG.value_type){case"unicode":S="Text";break;case"key":S="Relation";break;case"number":S="Number";break;case"date":S="DateTime";break;case"boolean":S="YesNo";break;default:S="Text"}}else{S=aG.element_type}}var aS=l.get_property(aG,"user_enabled_setting");var ao=true;if(Z===true||aS===2||(aU===false&&aS===1)||(S==="Attachments"&&h.can_edit_attachments===false)||S==="Button"||S==="SubmitButton"||S==="BlankCanvas"){ao=false}var T={name:ai,value:aa,label:a1,column_width:aY,before_first_save:aU,inline:aj,multi_line:l.get_property(aG,"number_of_lines_setting")===1&&aj!==true,save_first_hint:y.get_multilanguage_string(ML_KEYS.save_first_hint,"save this Card first to edit this element"),disable_label:aG.disable_label===true,hidden_in_client:l.get_property(aG,"hidden_in_client")===true};var aV=S;var aM=null;var az=null;var ae=null;var at=null;var aQ=null;if(typeof(aR)==="string"&&aR!==""){aQ=aR}else{aQ=y.get_active_language()}switch(S){case"Text":case"Number":var am=aG.field_triggers;if(Array.isArray(am)){var ab=[];var ax="";c(am,ab);if(ab.length>0){T.edit_options_available=true;ax=y.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit");T.edit_options=A(ab,ax,undefined,undefined,"flash",undefined,false)}}break;case"Button":var aA=aG.trigger;if(typeof(aA)=="string"&&aA!=""){var ah=y.resolve_key(aA,true);var aH=y.get_design_element_properties_by_name(ah,"js_call").value;T.action=aH}T.icon_url=aG.icon_url;break;case"YesNo":T.yes_text=y.get_multilanguage_string(ML_KEYS.yes,"yes");T.no_text=y.get_multilanguage_string(ML_KEYS.no,"no");break;case"Link":aV="Text";break;case"Choice":T.choices=P(aa,aG.choices);break;case"ColorChoice":if(typeof(aa)!=="string"||aa===""){aa="transparent"}T.choices=P(aa,COLORS,"Color","name");break;case"ApplicationChoice":aV="Choice";T.choices=P(aa,h.application_choices,"ApplicationChoice");break;case"DateTimeLanguageChoice":aV="Choice";h.supported_datetime_languages.browser="Browser Language";if(typeof(aa)!=="string"||aa===""){aa="browser"}T.choices=P(aa,h.supported_datetime_languages,"DateTimeLanguage");break;case"DateTimeFilter":var ab=[];aV="DateTimeFilter";if(aj!==true&&ao===true){ab.push({label:y.get_multilanguage_string(ML_KEYS.inline_edit_clear,"clear"),action:"clear",client_side:true,character_icon:"×"})}if(aj!==true){var ax="";ax=y.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit");
T.edit_options=A(ab,ax,undefined,undefined,"pencil",undefined,false)}T.datetime_display_setting=l.get_property(aG,"datetime_display_setting");if(T.datetime_display_setting==1){T.datetime_type_property='{{#mobile_client}}type="date"{{/mobile_client}}'}else{if(T.datetime_display_setting==2){T.datetime_type_property='{{#mobile_client}}type="time"{{/mobile_client}}'}else{T.datetime_type_property='{{#mobile_client}}type="datetime-local"{{/mobile_client}}'}}break;case"DateTime":T.datetime_display_setting=l.get_property(aG,"datetime_display_setting");if(T.datetime_display_setting==1){T.datetime_type_property="{{#mobile_client}}type=date{{/mobile_client}}"}else{if(T.datetime_display_setting==2){T.datetime_type_property='{{#mobile_client}}type="time"{{/mobile_client}}'}else{T.datetime_type_property='{{#mobile_client}}type="datetime-local"{{/mobile_client}}'}}break;case"MultilanguageText":if(aa!==""&&aU===false){if(aj!==true){T.edit_options=A([{label:y.get_multilanguage_string(ML_KEYS.inline_edit_change_meaning,"edit multilanguage card"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",name:ai,icon:"pencil"},{label:y.get_multilanguage_string(ML_KEYS.inline_edit_clear,"clear"),action:"clear",character_icon:"×",client_side:true}],y.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit"));T.edit_options_available=true}if(Array.isArray(aa)){z.log("multilanguage text element cannot be defined using multiple values");T.value=""}else{var aP=y.get_multilanguage_string_and_language(aa);T.value=aP[0];aQ=aP[1]}}if(typeof(aQ)!=="string"||aQ===""){aQ=y.get_active_language()}T.label+=" ("+aQ+")";break;case"Attachments":var ag=h.current_path;if(typeof(ag)!=="string"){ag=""}T.add_attachment_label=y.get_multilanguage_string(ML_KEYS.add_label);T.table_data=v(aa,ag+"/%40%40attachments");T.table_controls_in_header=aO===true;if(aO){ar.push({classname:"tableview-only-card"})}T.edit_options=A([{label:y.get_multilanguage_string(ML_KEYS.remove_from_tableview,"remove from this here"),action:"remove_from_tableview",no_update_action:"remove_from_tableview",name:ai,icon:"pencil"}],y.get_multilanguage_string(ML_KEYS.with_selected_label,"With Selected"),true,true,undefined,"btn-sm");break;case"RelationFilter":T.field_persistence="non-persistent";case"Relation":var ac=l.get_property(aG,"parent_entity_proto_setting");if(typeof(ac)==="string"&&ac!==""){T.proto_key=ac}else{ac=aG.parent_entity_proto_setting;T.proto_key=ac}aM=aG.parent_application_setting;if(typeof(aM)==="string"&&aM!==""){T.related_app_id=aM}var af=aG.cardinality_setting;var aq=null;if(af===0){ao=false;aV="ParentRelation"}else{if(af===2){if(h.can_edit_multivalue_relations===false){ao=false}var a2=[];var Y=null;if(Array.isArray(aa)){Y=aa}else{if(aa===""){Y=[]}else{if(typeof(aa)==="string"){Y=[aa]}else{z.log("invalid key defined for relation in design element "+ai,LOG_LEVEL.error);Y=[]}}}if(!aU||aI==="DynamicCard"){for(var aX=0;aX<Y.length;aX++){if(typeof(Y[aX])!=="string"||Y[aX].length===0){continue}aq=y.resolve_key(Y[aX],false);if(l.is_empty(aq)){z.log("cannot display related card "+Y[aX]+" in table "+ai+": card not found.");continue}if(aq.deleted===true){continue}if(l.is_empty(aq)){z.log("manually ordered relation contains non existing key or key pointing to invalid card: "+Y[aX],LOG_LEVEL.warning);continue}a2.push(aq)}}aV="ManuallyOrderedTableView";if(!aU&&aj!==true){var U=l.get_property(aG,"allow_new_cards");if(typeof(U)!=="string"){U=""}az=y.resolve_key(ac,false);T.table_data=g(ac,aM,a2,ai,av,aG);T.table_controls_in_header=aO===true;if(aO){ar.push({classname:"tableview-only-card"})}T.edit_options=o(ai,undefined,h.readonly!==true&&ao,true);T.allow_new_cards=U;T.use_select_column=h.selection_mode!="none"}else{if(!aU){aV="Text";var W=[];for(var aX=0;aX<a2.length;aX++){aq=a2[aX];W.push(y.get_short_representation(aq,undefined,undefined,undefined,undefined,undefined,true))}T.value=W.join(",")}}}else{aV="ParentRelation";var ab=[];var ax="";aq=null;if(typeof(aa)==="string"&&aa!==""){aq=y.resolve_key(aa,false)
}var aL=y.resolve_key(ac,false);if(aj!==true&&typeof(aq)==="object"&&aq!==null&&!(y.is_card_hidden(aq,aL,false))){ab.push({label:y.get_multilanguage_string(ML_KEYS.inline_edit_related,"edit related card"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",name:ai,is_disabled:aU,icon:"pencil",related_app_id:aM});ax=y.get_multilanguage_string(ML_KEYS.inline_edit_group_label,"edit")}if(aj!==true&&ao===true){ab.push({label:y.get_multilanguage_string(ML_KEYS.inline_edit_clear,"clear"),action:"clear",client_side:true,character_icon:"×"});if(!l.is_empty(aL)&&aG.filter_automatically_setting!==false){ae={};f(aL,undefined,ae,true);at=F(aZ,ae);T.filter_column_keys_by_element=JSON.stringify(at)}}if(aj!==true){T.edit_options=A(ab,ax,undefined,undefined,"pencil",undefined,false)}if(ao!==true){if(typeof(aq)==="object"&&aq!==null){T.relational_info=y.get_short_representation(aq,undefined,undefined,undefined,undefined,undefined,true)}else{T.relational_info=aa}}var a3=l.get_property(h,"choices_json_url");if(typeof(a3)!=="string"){a3=""}T.choices_json_url=a3;T.relation_resource_available=a3!=="";var aE="";if(typeof(aG.couchdb_viewname)==="string"){aE=aG.couchdb_viewname}T.couchdb_viewname=aE;var al=aG.parent_application_element;if(typeof(al)==="string"&&al!==""){T.app_choice_element=al}}}break;case"LanguageChoice":var ad=null;if(Array.isArray(aa)){ad=aa}else{if(aa===""){ad=[]}else{if(typeof(aa)==="string"){ad=[aa]}else{z.log("invalid values in language choice design element "+ai,LOG_LEVEL.error);ad=[]}}}aV="ManuallyOrderedTableView";if(!aU&&aj!==true){T.allow_new_cards=false;T.disable_click_to_open=true;az=y.resolve_key(ac,false);T.table_data={header_cells:[],rows:[]};T.table_data.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.locale,"Locale"),identifier:"&&locale",display_priority:10,is_sortable:false});T.table_data.header_cells.push({text:y.get_multilanguage_string(ML_KEYS.language,"Language"),identifier:"&&language",display_priority:10,is_sortable:false});for(var aT=0;aT<ad.length;aT++){var aD={key:ad[aT],cells:[]};aD.cells.push({identifier:"&&locale",content:ad[aT]});aD.cells.push({identifier:"&&language",content:LANGUAGE_BY_LOCALE[ad[aT]]});T.table_data.rows.push(aD)}T.table_controls_in_header=aO===true;if(aO){ar.push({classname:"tableview-only-card"})}T.edit_options=o(ai,undefined,false,true);T.use_select_column=h.selection_mode!="none";var an={};var aC=y.get_available_locales(aG.limit_variations_to_selected_languages===true,ad);for(var aT=0;aT<aC.length;aT++){var aJ=LANGUAGE_BY_LOCALE[aC[aT]];an[aC[aT]]=Object.create(D.StaticTextField,{value:{value:aJ},name:{value:aC[aT]}})}choice_element={name:"card_proto_choice",value_type:"key",element_type:"Choice",value:"",choices:an};av.push({modal_id:"tableviewAddActionModal_"+ai,title:y.get_multilanguage_string(ML_KEYS.application_language_choice_dialog_title),choice_id:"language_choice",choice_type:"object_key",content:C({name:"language_choice_description",value_type:"unicode",element_type:"Text",value:y.get_multilanguage_string(ML_KEYS.application_language_choice_dialog_description)},[],undefined,undefined,undefined,true,true)+C(choice_element,[],undefined,undefined,undefined,undefined,true),action_link_id:"confirm_link_modal_add_card",action_style:"primary"})}else{if(!aU){aV="Text";var W=[];for(var aT=0;aT<ad;aT++){W.push(LANGUAGE_BY_LOCALE[ad[aT]])}T.value=W.join(",")}}break;case"SubmitButton":ao=false;break;case"TableView":ao=false;aM=aG.application_setting;if(typeof(aM)==="string"&&aM!==""){T.related_app_id=aM}var aN=l.get_property(aG,"entity_proto_setting");az=y.resolve_key(aN,false);if(typeof(aN)==="string"){T.proto_key=aN}ae={};if(!aU){T.table_data=g(aN,aM,[],ai,av,aG,ae)}at=F(aZ,ae);var au=h.multiindex_column_keys_by_proto_key;if(typeof(au)!=="object"||au===null){au={}}var Q=au[aN];if(!(Array.isArray(Q))){Q=[]}T.filter_column_keys_by_element=JSON.stringify(at);T.column_keys_available_for_multiindex=JSON.stringify(Q);T.table_controls_in_header=aO===true;
if(aO){ar.push({classname:"tableview-only-card"})}T.table_height=aO?"400px":"200px";T.show_first_save_hint_instead=aU===true;T.show_create_button=h.readonly!==true&&y.are_new_cards_creatable(az);var aB=null;if(typeof(aG.couchdb_viewname)==="string"&&aG.couchdb_viewname!==""){aB=h.tableview_json_url_with_viewname+"/"+aG.couchdb_viewname}else{aB=h.tableview_json_url}if(typeof(aM)==="string"&&aM!==""&&aM!==h.application_key){matches=aB.match(/(.*\/)(.*?)(\/%40%40tableview_datasource.*?)/);if(matches===null){z.log("The tableview url "+aB+" for element "+ai+" does not follow the standard for foreign apps. Foreign app ID: "+aM);aB=""}else{aB=matches[1]+aM+matches[3]}}T.tableview_json_url=aB;var ap=[];var aW=aZ[aN];if(Array.isArray(aW)&&aW.length>0){var X=y.get_element_index(V);for(var aX=0;aX<aW.length;aX++){if(aW[aX]===ai||aW[aX]==="#"){continue}ap.push(X[aW[aX]])}}var am=aG.field_triggers;var a0=[];if(Array.isArray(am)){c(am,a0)}T.edit_options=o(ai,aG.couchdb_viewname,h.readonly!==true&&y.is_card_editable(null,az,false),undefined,ap,aN,a0);T.use_select_column=h.selection_mode!="none";break}T.language=aQ.replace("_","-");if(aK!==""){T.validation_error=[{text:aK}]}var ak=l.get_property(aG,"help_text");if(ak!==null&&ak!==undefined&&ak!==""){T.help_text=[{text:y.get_multilanguage_string(ak,"")}]}var aF="editable";if(ao===false){aF="readonly"}return Mustache.to_html(m("elements:"+aF+":"+aV),T)}if(typeof(L)==="object"&&L!==null){C=L.profile(C)}function t(i){return Mustache.to_html(m("others:card_row"),{content:i})}function q(U,Q,ab,Y,ac,ah,ad,W,R,ag,af){if(Y===undefined){Y=true}if(R===undefined){R=[]}if(typeof(ag)!=="boolean"){ag=false}if(typeof(af)!=="boolean"){af=false}if(U.length===0){return""}var X=Math.max(Math.floor(PAGE_WIDTH/U.length),DEFAULT_COLUMN_WIDTH);var V="";var T="";for(var ae=0;ae<U.length;ae++){var Z=U[ae];var S=y.get_design_element_identifier(Z);var aj=null;if(ag===true){aj=S}if(ag===true&&!(S in LANGUAGE_BY_LOCALE)){aj=null}var aa=ab[S];var ai=y.get_design_element_properties(Z);T+=C(Z,Q.design_elements,aa,ac,X,Y,undefined,ah,true,af,ad,W,R,aj)}return T}function H(W,aj,aS,aB,T,al){if(aS===undefined){aS=false}if(aj===undefined){aj={}}if(aB===undefined){aB={}}if(T===undefined){T={}}if(al===undefined){al={}}W=y.monkey_patch_card(W);var ad=y.resolve_key(W.proto_key,false);if(y.is_card_hidden(W,ad,false,aS)){z.log("Sorry, you don't have access to this Card.",LOG_LEVEL.message);return""}var aq=y.get_script_library(W);if(l.is_function(aq.on_render)){aq.on_render(W,aS)}var ax=l.get_property(W,"design_elements");var aQ="";var az=[];var ar=false;var Y=false;var aG=y.get_card_type(W);var ao=h.readonly!==true&&y.is_card_editable(W,ad,false,aS);var X="";var aw=[];var ak=false;if(W.proto_key==="&&multilanguageProto"){ak=true}var aT=false;var ae=null;if(W.definition_type==="ImportExportCard"){var at=l.get_property(h,"root_denominator");aQ+=t("<div class='col-sm-12'><a target='_blank' href='http://web.protogrid.com/choco/docs/Protogrid-CSV-Import.pdf'><img border='0' alt='CSV Import Instructions' style='padding:5px 10px 15px 0' src='"+at+"static/images/pdficon_large.png'>CSV Import</a></div>");aQ+=t("<div class='col-sm-12'><a target='_blank' href='http://web.protogrid.com/choco/docs/Protogrid-JSON-API.pdf'><img border='0' alt='JSON API Instructions' style='padding:5px 10px 15px 0' src='"+at+"static/images/pdficon_large.png'>JSON API</a></div>");aQ+=t("<div class='col-sm-12'><a target='_blank' href='https://github.com/protogrid/iOS/archive/1.0.4.zip'><img border='0' alt='iOS Standalone Project' style='padding:5px 10px 15px 0' src='"+at+"static/images/xcodeicon_32.png'>Xcode Project for iOS Rollout</a></div>")}else{if(Array.isArray(ax)){var aV=y.get_relation_field_ids_associated_to_proto_by_proto_key(W);var aE=[];var ap=0;var aF=null;var ay=0;for(var aU=0;aU<ax.length;aU++){var aA=W.design_elements[aU];aF=y.get_design_element_properties(aA);if(y.is_design_element_hidden(aF)){continue}if(aF.deleted===true){continue}if(aF.hidden_in_client===true){continue
}ay+=1;ae=aF.element_type;if(ay>1){break}}if(ay===1){aT=true}for(var aU=0;aU<ax.length;aU++){var aA=W.design_elements[aU];aF=y.get_design_element_properties(aA);if(y.is_design_element_hidden(aF)){continue}if(aF.deleted===true){continue}var Q=l.get_property(aF,"element_type");var af=l.get_property(aF,"cardinality_setting");var ac=l.get_property(aF,"grid_size_setting");var aL=l.get_property(aF,"creates_value");var an=l.get_property(aF,"field_triggers");if(!(Array.isArray(an))){an=[]}var Z=l.get_property(aF,"trigger");if(typeof(Z)==="string"&&Z!==""){an.push(Z)}var ah=y.get_design_element_identifier(aA);var aH=aj[ah];if(Q==="TableView"||Q==="Relation"&&af===2||ac===1||Q==="Code"){var aK=q(aE,W,aj,!ao,aS,az,aG,aV,aw,ak,aT);if(aK!==""){aQ+=t(aK)}ap=0;aE=[];aQ+=t(q([aA],W,aj,!ao,aS,az,aG,aV,aw,ak,aT))}else{aE.push(aA);if(l.get_property(aF,"hidden_in_client")!==true){ap+=DEFAULT_COLUMN_WIDTH}if(ap>=PAGE_WIDTH){aQ+=t(q(aE,W,aj,!ao,aS,az,aG,aV,aw,ak,aT));ap=0;aE=[]}}if(ao&&W.persistent!==false&&aF.user_enabled_setting!==2&&(aS!==true||aF.user_enabled_setting!==1)&&Q!=="TableView"&&Q!=="Button"&&aL!==false){ar=true}if(Array.isArray(an)){for(var aI=0;aI<an.length;aI++){al.load=true;var ag=y.resolve_key(an[aI],true);var ab=y.get_design_element_properties_by_name(ag,"client_script_library").value;if(typeof(ab)==="string"&&ab!==""){var am=y.resolve_key(ab,true);var aX=y.get_design_element_properties_by_name(am,"code").value;if(typeof(aX)==="string"){T[ab]=aX}}}}}var au=q(aE,W,aj,!ao,aS,az,aG,aV,undefined,ak,aT);if(au!==""){aQ+=t(au)}if(W.enable_attachments===true||(typeof(ad)==="object"&&ad!==null&&ad.get_value("enable_attachments")===true)){var aR=q([Object.create(D.StaticAttachmentField,{value:{value:W._attachments},name:{value:"attachments"}})],W,aj,!ao,aS,az,aG,aV,aw,ak,aT);aQ+=t(aR)}if(aT){aF=y.get_design_element_properties(ax[0]);if(aF.element_type==="TableView"||(aF.element_type==="Relation"&&aF.cardinality_setting===2)){Y=true}}var aO=l.get_property(W,"_id");X=q([{name:"card_id",value_type:"unicode",element_type:"Text",value:aO,label_multilanguage_key:ML_KEYS.card_id}],W,[],true,false,[],undefined,undefined);X+=q([{name:"card_type",value_type:"unicode",element_type:"Text",value:aG,label_multilanguage_key:ML_KEYS.card_type}],W,[],true,false,[],undefined,undefined);if(typeof(h.application_key)==="string"&&h.application_key!==""){X+=q([{name:"app_id",value_type:"unicode",element_type:"Text",value:l.get_property(h,"application_key"),label_multilanguage_key:ML_KEYS.app_id}],W,[],true,false,[],undefined,undefined)}}}var aa=[];var V=y.get_definition(W);if(h.allow_design_mode!==false&&(typeof(W.definition_type)!=="string"||W.definition_type==="")){aa.push({label:y.get_multilanguage_string(ML_KEYS.open_proto,"open proto"),action:"edit_related_card",no_update_action:"no_update_and_edit_related_card",icon:"pencil",related_key:V})}if(W.persistent!==false){aa.push({label:y.get_multilanguage_string(ML_KEYS.show_card_properties,"show properties"),action:"show_card_properties",client_side:true,modal_id:"cardPropertiesModal"});az.push({modal_id:"cardPropertiesModal",title:y.get_multilanguage_string(ML_KEYS.card_properties_title,"Card Properties"),content:X,action_link_id:"card_properties_modal",action_style:"primary"})}if(h.allow_trash_actions!==false&&ao&&W.deleted===true&&W.persistent!==false){aa.push({label:y.get_multilanguage_string(ML_KEYS.restore_label,"restore"),action:"restore",no_update_action:"no_update_and_restore",icon:"trash"})}else{if(h.allow_trash_actions!==false&&ao&&W.persistent!==false){aa.push({label:y.get_multilanguage_string(ML_KEYS.put_to_trash_label,"put to trash"),action:"put_to_trash",no_update_action:"no_update_and_put_to_trash",icon:"trash"})}}if(typeof(ad)==="object"&&ad!==null){aB.color=ad.get_value("theme_color");if(typeof(aB.color)!=="string"||aB.color===""||aB.color==="transparent"){aB.color=l.get_property(h,"theme_color")}}if(h.allow_design_mode!==false&&W.persistent!==false){var aC=N();for(var aU=0;aU<aC.length;aU++){var aM=aC[aU];
var S=y.resolve_key(aM,false);if(typeof(S)!=="object"||S===null){continue}var aW=y.get_element_index(S);if(aM==="&&designMenuDefinition"){var U=aW.menu_entries;if(Array.isArray(U.value)&&U.value.indexOf(W._id)!==-1){aB.color=null}}if(typeof(S)!=="object"||S===null||S.deleted===true||h.readonly===true||!(y.is_card_editable(S,undefined,false))){continue}var aJ=aW.title;var aD="Menu";if(!(l.is_empty(aJ))){aD=y.get_multilanguage_string(aJ.value,aD)}aa.push({label:y.get_multilanguage_string(ML_KEYS.put_into_menu_prefix,"put into menu").trim()+" '"+aD+"'",action:"put_to_menu",icon:"pencil",related_key:aM})}}var aN=ar;if(Array.isArray(aP)&&aP.length>1){aN=true}var R={additional_form_classes:aw,post_save_action:l.get_property(W,"post_save_action"),proto_key:V,card_key:W._id,parent_card_key:h.parent_card_key,parent_proto_key:h.parent_proto_key,share_button_available:W.hide_share_button!==true,save_label:y.get_multilanguage_string(ML_KEYS.save_label,"Save"),save_and_close_label:y.get_multilanguage_string(ML_KEYS.save_and_close_label,"Save and Close"),close_without_saving_label:y.get_multilanguage_string(ML_KEYS.close_without_saving_label,"Close without Saving"),rows:aQ,cancel_label:y.get_multilanguage_string(ML_KEYS.cancel_label,"Cancel"),action_label:y.get_multilanguage_string(ML_KEYS.ok_label,"OK"),before_first_save:aS,saveable_content_available:ar,card_closeable:aN,card_title:y.get_title(W,aS,true),card_actions_available:ar||aN||(aT&&ae==="TableView"),disable_padding:Y,deleted:W.deleted===true,deleted_label:y.get_multilanguage_string(ML_KEYS.deleted_label,"Deleted"),edit_options:A(aa,y.get_multilanguage_string(ML_KEYS.card_menu_label,"This Card"),true,true,undefined,"btn-xs",undefined,true),modal_dialogs:[{modal_id:"saveChangesModal",title:y.get_multilanguage_string(ML_KEYS.save_changes_modal_title,"Save Changes?"),content:y.get_multilanguage_string(ML_KEYS.save_changes_modal_description,"Do you want to save the changes made to this Card?"),action_link_id:"confirm_link_modal",action_style:"primary"},{modal_id:"discardChangesModal",title:y.get_multilanguage_string(ML_KEYS.discard_changes_modal_title,"Discard Changes?"),content:y.get_multilanguage_string(ML_KEYS.discard_changes_modal_description,"Are you sure to discard all changes made to this Card?"),action_link_id:"confirm_link_modal_discard",action_style:"danger"}].concat(az)};var aP=l.get_property(k,"navigation_stack");if(Array.isArray(aP)){R.breadcrumbs=[];for(var aU=0;aU<aP.length-1;aU++){var av={};av.card_id=aP[aU].id;av.app_id=aP[aU].app_id;var ai=y.resolve_key(av.card_id,false);if(ai===null){z.log("When rendering "+W._id+": could not resolve card "+av.card_id+" at position "+aU+" in navigation stack, app "+av.app_id);continue}av.representation=y.get_short_representation(ai,undefined,undefined,undefined,undefined,undefined,true);R.breadcrumbs.push(av)}}return Mustache.to_html(m("others:card"),R)}function b(V){var R={create_application_label:y.get_multilanguage_string(ML_KEYS.create_application_label,"Create Application"),delete_modal_title:y.get_multilanguage_string(ML_KEYS.delete_modal_title,"Deleting an Application"),delete_modal_description:y.get_multilanguage_string(ML_KEYS.delete_modal_description,"Are you sure that you want to delete this application? All design elements and data will be permanently deleted!"),cancel_label:y.get_multilanguage_string(ML_KEYS.cancel_label,"Cancel"),confirm_label:y.get_multilanguage_string(ML_KEYS.confirm_label,"Confirm"),applications:[],user_menu:u(false),show_environment_settings:y.is_current_user_admin(),show_create_application:y.is_current_user_admin()||y.get_user_role_keys().indexOf("&&applicationCreatorRole")!==-1,show_app_delete_button:y.is_current_user_admin(),environment_settings_label:y.get_multilanguage_string(ML_KEYS.environment_settings_label,"Environment Properties"),about_protogrid_label:y.get_multilanguage_string(ML_KEYS.about_protogrid_label,"About Protogrid"),issues_label:y.get_multilanguage_string(ML_KEYS.issues_label,"Report a Problem"),version:h.version,environment_title:h.environment_title};
if(Array.isArray(V)){for(var S=0;S<V.length;S++){var Y=V[S];var Q=l.get_property(Y,"url");if(Q===null||Q===undefined||Q===""){z.log("Invalid application bundle or no url specified",LOG_LEVEL.error);continue}var U=l.get_property(Y,"url_name");if(U===null||U===undefined||U===""){z.log("Invalid application bundle or no url name specified",LOG_LEVEL.error);continue}var X=l.get_property(Y,"logo_url");if(typeof(X)!=="string"||X===""){X="static/icons/protogrid-152.png"}var T=l.get_property(Y,"theme_color");if(typeof(T)!=="string"||T===""){T="transparent"}var W={url:Q,name:U,title:l.get_property(Y,"title"),description:l.get_property(Y,"description"),theme_color:T,logo_url:X,open_label:y.get_multilanguage_string(ML_KEYS.open_label,"Open"),delete_label:y.get_multilanguage_string(ML_KEYS.delete_label,"Delete")};if(["_users","users","_replicator","replicator","roles"].indexOf(U)!==-1){W.show_app_delete_button=false}R.applications.push(W)}}return Mustache.to_html(m("others:environment_portal"),R)}function E(ai,ak,i,W,ae,X,S){if(ak===undefined){ak=true}if(i===undefined){i=false}var R=l.get_property(h,"script_root");if(typeof(R)!=="string"){R="";z.log("invalid or no script root set in application context",LOG_LEVEL.error)}var ah=l.get_property(h,"current_path");if(typeof(ah)!=="string"){ah="";z.log("invalid or no path set in application context",LOG_LEVEL.error)}var am=l.get_property(h,"rows_per_ajax_request");if(typeof(am)!=="number"){am=0}var ag=l.get_property(h,"root_denominator");if(typeof(ag)!=="string"){ag=""}var ac=[];if(ak===true&&i===false){var Y=N();ac=p(Y)}var al=h.properties;var aq="";var an=ag+"static/images/logo.png";if(!(l.is_empty(al))){var ab=y.get_element_index(al);var af=l.get_property(ab.title,"value");var ad=l.get_property(ab.name,"value");var U=l.get_property(ab.icon_url,"value");if(typeof(U)==="string"&&U!==""){an=U}aq=y.get_multilanguage_string(af,ad)}var Z="";if(typeof(ae)==="string"&&ae!==""){Z="color-"+ae}var aa=[];if(typeof(X)==="object"){for(var ar in X){if(typeof(X[ar])==="string"){aa.push({code:X[ar]})}}}var Q=[];if(typeof(S)==="object"&&S.load===true){var V=y.resolve_key("&&codeOverviewCard",true);if(typeof(V)==="object"){var ap=V._attachments;if(typeof(ap)==="object"){for(var ao in ap){var T=ap[ao];if(typeof(T)==="object"&&T.content_type==="application/javascript"&&ao.indexOf(".js")!==-1){Q.push({attachment:"{{#callback_link_script_libraries}}"+ao+"{{/callback_link_script_libraries}}"})}else{z.log("code attachment with name '"+ao+"' not loaded, because of form requirements ('.js', content type 'application/javascript', charset 'utf-8').",LOG_LEVEL.error)}}}}}if(Array.isArray(Q)&&Q.length>10){z.log("just loaded "+Q.length+" code attachments for this card. we recommend using at most 10 code attachments.",LOG_LEVEL.warning)}var aj={theme_class:Z,content:ai,application_id:l.get_property(h,"application_key"),create_label:y.get_multilanguage_string(ML_KEYS.create_label,"Create"),add_label:y.get_multilanguage_string(ML_KEYS.add_label,"Add"),script_root:R,root_denominator:ag,current_path:ah,rows_per_ajax_request:am,app_title_available:aq!=="",application_title:aq,application_logo_url:an,menus:ac,menus_available:ak===true,show_environment_link:h.is_multi_app_client!==false,user_menu:u(W),preferred_locale:l.get_property(k,"preferred_locale"),app_locale:l.get_property(k,"current_language"),datetime_locale:l.get_property(k,"datetime_locale"),direct_client_script_libraries:aa,direct_client_script_libraries_available:Array.isArray(aa)&&aa.length>0,link_client_script_libraries:Q,link_client_script_libraries_available:Array.isArray(Q)&&Q.length>0};return Mustache.to_html(m("others:base"),aj)}function K(aj,X){function am(i){if(!(Array.isArray(i["#"]))||i["#"].length===0){z.log("invalid tableview data entry without key",LOG_LEVEL.error);return null}return i["#"][0]}function an(i){return"<div data-type='key'>"+i+"</div>"}function Y(i,ap,aq){if(aq===undefined){aq=0}return Mustache.to_html(m("elements:readonly:DateTime"),{inline:true,value:i,datetime_display_setting:aq})
}function af(ap,aq){var i=y.resolve_key("org.couchdb.user:"+ap,false);var ar="";if(typeof(i)==="object"&&i!==null){ar=y.get_short_representation(i,undefined,undefined,undefined,undefined,undefined,true)}else{ar=ap}return Mustache.to_html(m("elements:readonly:ParentRelation"),{inline:true,relational_info:ar})}function S(i,ap){return Mustache.to_html(m("elements:readonly:Text"),{inline:true,value:i})}function ag(au,ar,ap,aq){var i=ar[ap];if(typeof(i)===aq){return i}if(typeof(au)!=="object"||au===null){return null}var at=y.get_element_index(au);i=l.get_property(at[ap],"value");if(typeof(i)===aq){return i}i=l.get_property(au,ap);if(typeof(i)===aq){return i}return null}function ak(ap){var aq=y.resolve_key(ap,true);var i="";if(aq!==null){i=y.get_short_representation(aq,undefined,undefined,undefined,undefined,undefined,true)}return i}function Q(ap){var i=null;if(ap.length>1&&typeof(ap[1])==="object"&&ap[1]!==null&&!(Array.isArray(ap[1]))){i=y.get_multilanguage_string_and_language_from_object_indexed_by_language(ap[1],function(aq){return aq})[0]}else{if((ap.length===2||ap.length===1)&&typeof(ap[0])==="string"&&ap[0]!==""){i=ak(ap[0])}}return i}function ao(ar,ax){var aq="";if(!(ax in ar)){return aq}var av=ar[ax];var ap=null;if(Array.isArray(av)&&av.length>0&&Array.isArray(av[0])){for(var au=0;au<av.length;au++){var at=Q(av[au]);if(typeof(at)==="string"&&at!==""){if(aq!==""){aq+=", "}aq+=at}}}else{if(Array.isArray(av)){aq=Q(av);if(typeof(aq)!=="string"||aq===""){aq="";for(var au=0;au<av.length;au++){var aw=y.resolve_key(av[au],false);if(typeof(aw)!=="object"||aw===null){continue}if(aq!==""){aq+=", "}aq+=ak(av[au])}}}else{if(typeof(av)==="string"&&av!==""){aq=ak(av)}else{if(typeof(av)!=="string"){z.log("Invalid entry '"+ax+"' in tableview data: "+JSON.stringify(ar))}}}}return aq}function aa(ap,at,aq,au){if(!(at in ap)&&(typeof(aq)!=="object"||aq===null)){var i=y.resolve_key(am(ap),false);if(i===null||i===undefined){return null}var ar="";switch(at){case"#":z.log("tableview data entry without key",LOG_LEVEL.error);break;case"&&shortname":ar=y.get_short_representation(i,undefined,undefined,undefined,undefined,undefined,true);break;case"&&modified":ar=y.get_value_from_last_modification_log_entry(i,"time");break;case"&&created":ar=y.get_value_from_first_modification_log_entry(i,"time");break;case"&&modifier":ar=y.get_value_from_last_modification_log_entry(i,"user");break;case"&&creator":ar=y.get_value_from_first_modification_log_entry(i,"user");break;case"&&type":ar=y.get_displayable_card_type(i);break}aq={definition_key:at,value:ar}}else{if(typeof(aq)!=="object"||aq===null){aq={definition_key:at,value:ap[at][0]}}}if(at==="#"){return an(aq.value)}if(at==="&&shortname"){if(typeof(aq.value)==="object"&&aq.value!==null){ml_text=y.get_multilanguage_string_and_language_from_object_indexed_by_language(aq.value,function(aw){return aw})[0];return S(ml_text,at)}if(typeof(aq.value)==="string"){return S(aq.value,at)}z.log("could not render own shortname - invalid data type in tableview data: "+typeof(aq.value));return null}if(at==="&&type"){return aq.value}if(at==="&&modified"||at==="&&created"){return Y(aq.value,at)}if(at==="&&modifier"||at==="&&creator"){return af(aq.value,at)}if(ag(au,aq,"deleted","boolean")===true){return null}if(ag(au,aq,"display_priority","number")===0){return null}var av=ag(au,aq,"element_type","string");if(typeof(av)!=="string"||av===""||["TableView","Button","Code"].indexOf(av)!==-1){return null}if(av==="Relation"){ml_text=ao(ap,at);return S(ml_text,at)}if(["Text","Number"].indexOf(av)!==-1){if(typeof(aq.value)==="number"){return aq.value.toString()}return aq.value}if(av==="DateTime"){return Y(aq.value,at,ag(au,aq,"datetime_display_setting","number"))}return C(aq,undefined,undefined,undefined,undefined,true,true,undefined,false)}function V(ar,at){if(l.is_empty(ar)){z.log("cannot reconstruct card from tableview data entry: empty entry");return{}}if(l.is_empty(at)){z.log("cannot reconstruct card from tableview data entry: no proto");
return{}}var ax=[];var av=y.get_element_index(at);if(!(typeof(av)==="object")||!(typeof(av.card_design_elements)==="object")){z.log("invalid proto: no element_index or card_design_elements is not an object: "+String(av));return{}}var aw=av.card_design_elements.value;if(!(Array.isArray(aw))){z.log("invalid proto: card_design_elements is not a multivalue field: "+String(av.card_design_elements));return{}}for(var au=0;au<aw.length;au++){var ay="";if(aw[au] in ar){ay=ar[aw[au]][0]}ax.push({definition_key:aw[au],value:ay})}var aq=[];var az={};if("&&creator" in ar){az.user=ar["&&creator"][0]}if("&&created" in ar){az.time=ar["&&created"][0]}var ap={};if("&&modifier" in ar){ap.user=ar["&&modifier"][0]}if("&&modified" in ar){ap.time=ar["&&modified"][0]}aq.push(az);aq.push(ap);return{_id:ar["#"][0],proto_key:at._id,design_elements:ax,modification_log:aq}}if(typeof(X)!=="string"){X=""}if(!(Array.isArray(aj))){z.log("invalid input to tableview data gathering function",LOG_LEVEL.error);return[]}var al=[];for(var ah=0;ah<aj.length;ah++){var R=null;var Z=null;if("&&proto_key" in aj[ah]){Z=y.resolve_key(aj[ah]["&&proto_key"][0])}if(Z!==null){R=V(aj[ah],Z)}else{R=y.resolve_key(am(aj[ah]));var ae=y.get_card_type(R);R=y.get_healed_card(R)}if(typeof(R._id)!=="string"||R._id===""){continue}if(y.is_card_hidden(R,Z,false)){continue}var ac={};var U=y.get_element_index(R);var W=Object.keys(U);var ab=null;for(var ai=0;ai<W.length;ai++){var ad=y.resolve_key(W[ai],false);ab=aa(aj[ah],W[ai],U[W[ai]],ad);if(typeof(ab)!=="string"){continue}ac[W[ai]]=ab}var T=["#","&&shortname","&&modified","&&created","&&modifier","&&creator","&&type"];for(var ai=0;ai<T.length;ai++){ab=aa(aj[ah],T[ai]);if(typeof(ab)!=="string"){continue}ac[T[ai]]=ab}if(h.selection_mode!="none"){ac["&&select"]="<input type='checkbox' class='no-click-to-open selected-single' name='selected_"+X+"' value='"+R._id+"'>"}al.push(ac)}return al}var G={render_card:H,render_page:E,render_environment_portal:b,get_rendered_tableview_data:K};var s={};var d=Object.keys(G);for(var M=0;M<d.length;M++){var r=G[d[M]];if(typeof(L)==="object"&&L!==null){s[d[M]]=L.profile(r)}else{s[d[M]]=r}}return s};